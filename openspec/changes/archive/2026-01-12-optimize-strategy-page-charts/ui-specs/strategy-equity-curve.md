# ç­–ç•¥è©³æƒ…é é¢ - æ¬Šç›Šæ›²ç·šè¨­è¨ˆè¦æ ¼

## ğŸ“‹ éœ€æ±‚ç†è§£

### ç›®æ¨™
åœ¨ç­–ç•¥è©³æƒ…å±•é–‹å€åŸŸä¸­é¡¯ç¤º**çœŸå¯¦çš„æ¬Šç›Šæ›²ç·š**å’Œ**æœˆåº¦å ±é…¬ç†±åŠ›åœ–**ï¼Œå–ä»£ç¾æœ‰çš„å‡æ•¸æ“šã€‚ä½¿ç”¨è€…å¯ä»¥é€šéæ™‚é–“ç¯„åœé¸æ“‡å™¨çµ±ä¸€æ§åˆ¶å…©å€‹åœ–è¡¨çš„é¡¯ç¤ºå€é–“ã€‚

### ä½¿ç”¨è€…
é‡åŒ–äº¤æ˜“è€…ï¼Œéœ€è¦:
- æŸ¥çœ‹ç­–ç•¥åœ¨å›æ¸¬æœŸé–“çš„çœŸå¯¦æ¬Šç›Šè®ŠåŒ–
- äº†è§£æœˆåº¦å ±é…¬åˆ†å¸ƒå’Œæ³¢å‹•æ€§
- é¸æ“‡ç‰¹å®šæ™‚é–“ç¯„åœé€²è¡Œç´°éƒ¨åˆ†æ
- å¿«é€Ÿè­˜åˆ¥é—œéµç¸¾æ•ˆæ™‚æœŸï¼ˆé«˜/ä½å ±é…¬æœˆä»½ï¼‰

### é—œéµäº’å‹•
1. å±•é–‹ç­–ç•¥åˆ—è¡¨é …ç›®ï¼ŒæŸ¥çœ‹è©³ç´°åœ–è¡¨
2. ä½¿ç”¨æ™‚é–“ç¯„åœæ»‘æ¡¿åŒæ­¥ç¸®æ”¾å…©å€‹åœ–è¡¨
3. Hover åœ–è¡¨æŸ¥çœ‹å…·é«”æ•¸å€¼
4. è¦–è¦ºåŒ–è­˜åˆ¥ç¸¾æ•ˆè¶¨å‹¢

### UX è€ƒé‡ï¼ˆåŸºæ–¼ psychology.mdï¼‰

**è¦–è¦ºå±¤ç´šï¼ˆGestalt Principlesï¼‰**:
- æ¬Šç›Šæ›²ç·šç‚ºä¸»è¦ç„¦é»ï¼ˆä½”æ“šä¸Šæ–¹è¼ƒå¤§ç©ºé–“ï¼‰
- æœˆåº¦ç†±åŠ›åœ–ç‚ºè£œå……è³‡è¨Šï¼ˆä¸‹æ–¹æ¬¡è¦ä½ç½®ï¼‰
- æ™‚é–“ç¯„åœé¸æ“‡å™¨æ”¾åœ¨åœ–è¡¨ä¸Šæ–¹ï¼ˆCommon Region åˆ†çµ„ï¼‰

**èªçŸ¥è² è·æœ€å°åŒ–ï¼ˆMiller's Lawï¼‰**:
- æ¯å€‹åœ–è¡¨å°ˆæ³¨å–®ä¸€è³‡è¨Šï¼ˆæ¬Šç›Š vs æœˆåº¦å ±é…¬ï¼‰
- çµ±ä¸€çš„æ™‚é–“è»¸æ¸›å°‘èªçŸ¥è² æ“”

**å³æ™‚å›é¥‹ï¼ˆFitts's Lawï¼‰**:
- Hover æ™‚ç«‹å³é¡¯ç¤º tooltip
- æ»‘æ¡¿èª¿æ•´å¾Œå³æ™‚æ›´æ–°åœ–è¡¨

**ç†Ÿæ‚‰æ€§ï¼ˆJakob's Lawï¼‰**:
- éµå¾ª Plotly æ¨™æº–äº’å‹•æ¨¡å¼
- æ™‚é–“é¸æ“‡å™¨ä½¿ç”¨ Streamlit åŸç”Ÿå…ƒä»¶

---

## ğŸ“ LAYOUT

### å±•é–‹å€åŸŸçµæ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [ç­–ç•¥åç¨±] MA Cross (10/30)                    [æ”¶åˆ â–²]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ æ™‚é–“ç¯„åœé¸æ“‡                                          â”‚ â”‚
â”‚  â”‚ [â”â”â”â”â”â—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â—â”â”â”â”â”â”]        â”‚ â”‚
â”‚  â”‚ 2024-01-01                              2024-12-31   â”‚ â”‚
â”‚  â”‚                            [é‡ç½®ç¯„åœ]                 â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“ˆ æ¬Šç›Šæ›²ç·š                                           â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [æŠ˜ç·šåœ–: æ—¥æœŸ vs æ¬Šç›Š]                              â”‚ â”‚
â”‚  â”‚  é«˜åº¦: 400px                                         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚ ğŸ“Š æœˆåº¦å ±é…¬ç†±åŠ›åœ–                                     â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â”‚  [ç†±åŠ›åœ–: æœˆä»½ x å¹´ä»½]                               â”‚ â”‚
â”‚  â”‚  é«˜åº¦: 200px                                         â”‚ â”‚
â”‚  â”‚                                                       â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä½ˆå±€æ¨¡å¼
- **å®¹å™¨**: Streamlit `st.expander()` å±•é–‹å…ƒä»¶
- **æ™‚é–“é¸æ“‡å™¨**: `st.columns([4, 1])` - å·¦å´æ»‘æ¡¿ï¼Œå³å´é‡ç½®æŒ‰éˆ•
- **åœ–è¡¨ä½ˆå±€**: å‚ç›´å †ç–Šï¼ˆ`st.container()`ï¼‰
- **åœ–è¡¨å¯¬åº¦**: `use_container_width=True` è‡ªé©æ‡‰

### é–“è·ç³»çµ±ï¼ˆåŸºæ–¼ tokens.md + styles.pyï¼‰

```css
/* å·²å®šç¾©æ–¼ styles.py */
--spacing-sm: 0.5rem;   /* 8px  - åœ–è¡¨å…§å…ƒç´ é–“è· */
--spacing-md: 1rem;     /* 16px - æ™‚é–“é¸æ“‡å™¨èˆ‡åœ–è¡¨é–“è· */
--spacing-lg: 1.5rem;   /* 24px - å…©å€‹åœ–è¡¨ä¹‹é–“é–“è· */
```

### å®¹å™¨å°ºå¯¸

| å…ƒç´  | é«˜åº¦ | å¯¬åº¦ |
|------|------|------|
| æ™‚é–“é¸æ“‡å™¨å€å¡Š | 80px | 100% |
| æ¬Šç›Šæ›²ç·šåœ–è¡¨ | 400px | 100% |
| æœˆåº¦å ±é…¬ç†±åŠ›åœ– | 200px | 100% |
| åœ–è¡¨é–“è· | 24px (`--spacing-lg`) | - |

---

## ğŸ¨ VISUAL

### é¡è‰²æ–¹æ¡ˆï¼ˆåŸºæ–¼ tokens.md + styles.pyï¼‰

```css
/* èªæ„åŒ–è‰²å½© - å·²å®šç¾©æ–¼ styles.py */
--color-primary: #2563eb;         /* æ¬Šç›Šæ›²ç·šä¸»ç·š */
--color-success: #22c55e;         /* æ­£å ±é…¬ï¼ˆç†±åŠ›åœ–ç¶ è‰²ç«¯ï¼‰ */
--color-error: #ef4444;           /* è² å ±é…¬ï¼ˆç†±åŠ›åœ–ç´…è‰²ç«¯ï¼‰ */
--color-text: #111827;            /* æ¨™é¡Œã€è»¸æ¨™ç±¤ */
--color-text-secondary: #6b7280;  /* è¼”åŠ©æ–‡å­— */
--color-border: #e5e7eb;          /* åœ–è¡¨é‚Šæ¡† */
--color-surface: #ffffff;         /* åœ–è¡¨èƒŒæ™¯ */
--color-surface-raised: #f9fafb;  /* æ™‚é–“é¸æ“‡å™¨èƒŒæ™¯ */
```

### æ¬Šç›Šæ›²ç·šé¡è‰²

```python
# ä¸»ç·š
line_color = '#2563eb'  # --color-primary
line_width = 2

# å¡«å……å€ï¼ˆå¯é¸ï¼šæ›²ç·šä¸‹æ–¹æ·¡è‰²å¡«å……ï¼‰
fill_color = 'rgba(37, 99, 235, 0.1)'  # --color-primary with 10% opacity
```

### æœˆåº¦å ±é…¬ç†±åŠ›åœ–é¡è‰²

```python
# Plotly colorscale
colorscale = 'RdYlGn'  # ç´…-é»ƒ-ç¶ ï¼ˆè² -ä¸­æ€§-æ­£ï¼‰

# è‰²å½©æ˜ å°„é‚è¼¯
# < 0%  ç´…è‰²ç³» (#ef4444 ç³»åˆ—)
# â‰ˆ 0%  é»ƒè‰²ç³» (#eab308 ç³»åˆ—)
# > 0%  ç¶ è‰²ç³» (#22c55e ç³»åˆ—)

# è‰²æ¢ï¼ˆColorbarï¼‰
colorbar = {
    'title': 'å ±é…¬ç‡ (%)',
    'titlefont': {'size': 12},
    'tickfont': {'size': 10},
    'thickness': 15,
    'len': 0.7
}
```

### èƒŒæ™¯èˆ‡è¡¨é¢ï¼ˆ60-30-10 æ³•å‰‡æ‡‰ç”¨ï¼‰

```
60% - ä¸»èƒŒæ™¯
  åœ–è¡¨å€åŸŸ: --color-surface (#ffffff)

30% - æ¬¡è¦å€åŸŸ
  æ™‚é–“é¸æ“‡å™¨èƒŒæ™¯: --color-surface-raised (#f9fafb)

10% - å¼·èª¿è‰²
  æ¬Šç›Šæ›²ç·š: --color-primary (#2563eb)
  ç†±åŠ›åœ–æ­£å€¼: --color-success (#22c55e)
  ç†±åŠ›åœ–è² å€¼: --color-error (#ef4444)
```

### å­—é«”è¦ç¯„ï¼ˆåŸºæ–¼ tokens.mdï¼‰

```css
/* åœ–è¡¨æ¨™é¡Œ */
title: 1.125rem (18px), font-weight: 600, color: var(--color-text)

/* è»¸æ¨™ç±¤ */
axis_labels: 0.875rem (14px), font-weight: 400, color: var(--color-text-secondary)

/* Tooltip æ–‡å­— */
tooltip: 0.875rem (14px), font-weight: 400, background: white

/* ç†±åŠ›åœ–æ•¸å€¼æ¨™è¨» */
heatmap_text: 0.75rem (12px), font-weight: 500
```

### é‚Šæ¡†èˆ‡åœ“è§’ï¼ˆåŸºæ–¼ styles.pyï¼‰

```css
/* æ™‚é–“é¸æ“‡å™¨å®¹å™¨ */
border-radius: var(--radius-lg);  /* 8px */
border: 1px solid var(--color-border);
padding: var(--spacing-md);

/* åœ–è¡¨å®¹å™¨ */
border-radius: var(--radius-lg);  /* 8px */
```

---

## ğŸ”„ STATES

### åœ–è¡¨è¼‰å…¥ç‹€æ…‹

| ç‹€æ…‹ | è¦–è¦º | èªªæ˜ |
|------|------|------|
| **è¼‰å…¥ä¸­** | Spinner + Skeleton | åˆæ¬¡è¼‰å…¥æ•¸æ“š |
| **æ•¸æ“šç¼ºå¤±** | Empty State | å¯¦é©—æœªå„²å­˜ equity_curve |
| **æ­£å¸¸é¡¯ç¤º** | å®Œæ•´åœ–è¡¨ | æˆåŠŸè¼‰å…¥æ•¸æ“š |
| **éŒ¯èª¤** | Error Alert | æ•¸æ“šæ ¼å¼éŒ¯èª¤ |

### è¼‰å…¥ä¸­ï¼ˆLoadingï¼‰

```python
with st.spinner('è¼‰å…¥æ¬Šç›Šæ›²ç·š...'):
    # è¼‰å…¥æ•¸æ“š
    equity_curve = load_equity_curve(experiment_id)
```

è¦–è¦ºå…ƒç´ ï¼š
- Streamlit åŸç”Ÿ spinner
- ä½ç½®ï¼šåœ–è¡¨ä¸­å¿ƒ
- é¡è‰²ï¼š`--color-primary`

### æ•¸æ“šç¼ºå¤±ï¼ˆEmpty Stateï¼‰

```python
st.info("""
ğŸ“Š **æ¬Šç›Šæ›²ç·šæ•¸æ“šç¼ºå¤±**

æ­¤ç­–ç•¥å¯¦é©—æœªå„²å­˜è©³ç´°æ¬Šç›Šæ›²ç·šè³‡æ–™ã€‚

**å¯èƒ½åŸå› **ï¼š
- å¯¦é©—è¨˜éŒ„æ–¼èˆŠç‰ˆæœ¬ç³»çµ±
- å›æ¸¬æœªæ­£å¸¸å®Œæˆ

**å»ºè­°**ï¼š
- é‡æ–°åŸ·è¡Œå›æ¸¬
- æª¢æŸ¥å¯¦é©—è¨˜éŒ„å®Œæ•´æ€§
""")
```

è¦–è¦ºå…ƒç´ ï¼š
- ä½¿ç”¨ `st.info()` è—è‰²æç¤ºæ¡†
- åœ–ç¤ºï¼šğŸ“Š
- åŒ…å«åŸå› èªªæ˜å’Œå»ºè­°æ“ä½œ

### éŒ¯èª¤ç‹€æ…‹ï¼ˆErrorï¼‰

```python
st.error(f"""
âŒ **è¼‰å…¥å¤±æ•—**

{error_message}

**è©³ç´°éŒ¯èª¤**ï¼š
```
{traceback_info}
```
""")
```

è¦–è¦ºå…ƒç´ ï¼š
- ä½¿ç”¨ `st.error()` ç´…è‰²è­¦å‘Šæ¡†
- åœ–ç¤ºï¼šâŒ
- é¡¯ç¤ºéŒ¯èª¤è¨Šæ¯å’ŒæŠ€è¡“ç´°ç¯€

### æ™‚é–“é¸æ“‡å™¨ç‹€æ…‹

**é è¨­ï¼ˆDefaultï¼‰**:
- é¡¯ç¤ºå®Œæ•´æ™‚é–“ç¯„åœ
- æ»‘æ¡¿æŠŠæ‰‹ä½æ–¼å…©ç«¯

**é¸æ“‡ä¸­ï¼ˆActiveï¼‰**:
- æ»‘æ¡¿æ‹–å‹•æ™‚ï¼Œå³æ™‚æ›´æ–°æ—¥æœŸæ¨™ç±¤
- åœ–è¡¨å³æ™‚ç¸®æ”¾ï¼ˆsession_state æ›´æ–°ï¼‰

**é‡ç½®ï¼ˆResetï¼‰**:
- é»æ“Šã€Œé‡ç½®ç¯„åœã€æŒ‰éˆ•
- æ»‘æ¡¿å›åˆ°å…©ç«¯
- åœ–è¡¨é¡¯ç¤ºå®Œæ•´ç¯„åœ

---

## ğŸ“± RESPONSIVE

### ä¸»è¦è£ç½®
- **Desktop**: 1280px+ (ä¸»è¦ä½¿ç”¨å ´æ™¯)
- **Tablet**: 768px-1280px
- **Mobile**: < 768px (æ¬¡è¦ï¼Œå¯èƒ½éš±è—æˆ–ç¸®å°åœ–è¡¨)

### åœ–è¡¨éŸ¿æ‡‰å¼è¨­è¨ˆ

```python
# Streamlit è‡ªå‹•è™•ç†éŸ¿æ‡‰å¼
st.plotly_chart(fig, use_container_width=True)

# åœ–è¡¨é«˜åº¦æ ¹æ“šè¢å¹•å¯¬åº¦èª¿æ•´ï¼ˆå¯é¸ï¼‰
import streamlit as st

# åµæ¸¬è¢å¹•å¯¬åº¦ï¼ˆéœ€è¦é¡å¤– JSï¼Œéå¿…è¦ï¼‰
# æˆ–ä½¿ç”¨å›ºå®šé«˜åº¦ï¼Œä¾è³´ Plotly å…§å»ºç¸®æ”¾
```

### åœ–è¡¨é«˜åº¦èª¿æ•´

| è£ç½® | æ¬Šç›Šæ›²ç·šé«˜åº¦ | ç†±åŠ›åœ–é«˜åº¦ |
|------|--------------|------------|
| Desktop (â‰¥1280px) | 400px | 200px |
| Tablet (768-1280px) | 350px | 180px |
| Mobile (<768px) | 300px | 150px |

> **å¯¦ä½œæ–¹å¼**ï¼šStreamlit çš„ `use_container_width=True` è‡ªå‹•è™•ç†å¯¬åº¦ï¼Œé«˜åº¦ä½¿ç”¨å›ºå®šå€¼ï¼ˆPlotly layout.heightï¼‰ã€‚è¡Œå‹•è£ç½®å»ºè­°ä½¿ç”¨è¼ƒå°é«˜åº¦ä»¥æ¸›å°‘æ²å‹•ã€‚

---

## ğŸ“Š æ™‚é–“ç¯„åœé¸æ“‡å™¨è¦æ ¼

### å…ƒä»¶é…ç½®

```python
# ä½ˆå±€
col_slider, col_reset = st.columns([4, 1])

with col_slider:
    # æ™‚é–“ç¯„åœæ»‘æ¡¿
    date_range = st.slider(
        label="é¸æ“‡æ™‚é–“ç¯„åœ",
        min_value=min_date,
        max_value=max_date,
        value=(min_date, max_date),  # é è¨­å…¨ç¯„åœ
        format="YYYY-MM-DD",
        key="equity_date_range"
    )

with col_reset:
    # é‡ç½®æŒ‰éˆ•ï¼ˆå‚ç›´ç½®ä¸­ï¼‰
    st.markdown("<div style='padding-top: 1.5rem;'></div>", unsafe_allow_html=True)
    if st.button("ğŸ”„ é‡ç½®ç¯„åœ", key="reset_date_range"):
        st.session_state.equity_date_range = (min_date, max_date)
        st.rerun()
```

### è¦–è¦ºæ¨£å¼

**æ»‘æ¡¿æ¨£å¼**ï¼ˆå·²å®šç¾©æ–¼ styles.pyï¼‰:
```css
.stSlider > div > div > div {
    background: var(--color-primary);  /* #2563eb */
}
```

**é‡ç½®æŒ‰éˆ•æ¨£å¼**:
- é¡å‹ï¼š`type="secondary"` (Streamlit é è¨­æ¬¡è¦æŒ‰éˆ•)
- åœ–ç¤ºï¼šğŸ”„ è¡¨ç¤ºé‡ç½®å‹•ä½œ
- å°é½Šï¼šèˆ‡æ»‘æ¡¿å‚ç›´ç½®ä¸­

### äº’å‹•é‚è¼¯

```python
# 1. åˆå§‹åŒ– session_state
if 'chart_xrange' not in st.session_state:
    st.session_state.chart_xrange = (min_date, max_date)

# 2. æ»‘æ¡¿è®ŠåŒ–æ™‚æ›´æ–°
selected_range = st.slider(...)
if selected_range != st.session_state.chart_xrange:
    st.session_state.chart_xrange = selected_range

# 3. åœ–è¡¨ä½¿ç”¨çµ±ä¸€ç¯„åœ
fig.update_xaxes(range=st.session_state.chart_xrange)
```

---

## ğŸ“ˆ æ¬Šç›Šæ›²ç·šåœ–è¡¨è¦æ ¼

### è³‡æ–™ä¾†æº

```python
# å¾ BacktestResult è¼‰å…¥
equity_curve = load_equity_curve(experiment_id)
# é æœŸæ ¼å¼: pd.Series
#   Index: DatetimeIndex (æ—¥æœŸ)
#   Values: float (æ¬Šç›Šå€¼)
```

### Plotly é…ç½®

```python
import plotly.graph_objects as go

fig = go.Figure()

# ä¸»ç·š
fig.add_trace(go.Scatter(
    x=equity_curve.index,
    y=equity_curve.values,
    mode='lines',
    name='æ¬Šç›Š',
    line=dict(
        color='#2563eb',  # --color-primary
        width=2
    ),
    hovertemplate='<b>æ—¥æœŸ</b>: %{x|%Y-%m-%d}<br>' +
                  '<b>æ¬Šç›Š</b>: $%{y:,.2f}<br>' +
                  '<extra></extra>'
))

# å¯é¸ï¼šå¡«å……å€åŸŸ
fig.add_trace(go.Scatter(
    x=equity_curve.index,
    y=equity_curve.values,
    fill='tozeroy',
    fillcolor='rgba(37, 99, 235, 0.1)',  # --color-primary 10% opacity
    line=dict(width=0),
    showlegend=False,
    hoverinfo='skip'
))

# ä½ˆå±€é…ç½®
fig.update_layout(
    title=dict(
        text='æ¬Šç›Šæ›²ç·š',
        font=dict(size=18, weight=600, color='#111827')  # --color-text
    ),
    xaxis=dict(
        title='æ—¥æœŸ',
        titlefont=dict(size=14, color='#6b7280'),  # --color-text-secondary
        tickfont=dict(size=12),
        gridcolor='#f3f4f6',
        range=st.session_state.chart_xrange  # æ‡‰ç”¨æ™‚é–“ç¯„åœ
    ),
    yaxis=dict(
        title='æ¬Šç›Š ($)',
        titlefont=dict(size=14, color='#6b7280'),
        tickfont=dict(size=12),
        gridcolor='#f3f4f6',
        tickformat='$,.0f'  # è²¨å¹£æ ¼å¼
    ),
    height=400,
    margin=dict(l=60, r=40, t=60, b=60),
    plot_bgcolor='white',
    paper_bgcolor='white',
    hovermode='x unified',
    hoverlabel=dict(
        bgcolor='white',
        font_size=13,
        font_family="'Inter', sans-serif"
    )
)

# çµ±ä¸€é…ç½®ï¼ˆå·¥å…·åˆ—ã€ç¸®æ”¾ç­‰ï¼‰
fig.update_xaxes(showspikes=True, spikecolor='#d1d5db', spikethickness=1)
fig.update_yaxes(showspikes=True, spikecolor='#d1d5db', spikethickness=1)
```

### Hover Tooltip è¦æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ—¥æœŸ: 2024-05-15    â”‚
â”‚ æ¬Šç›Š: $12,345.67    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¼å¼è¦å‰‡**:
- æ—¥æœŸï¼š`YYYY-MM-DD`
- é‡‘é¡ï¼šåƒåˆ†ä½é€—è™Ÿ + å…©ä½å°æ•¸

### å·¥å…·åˆ—é…ç½®

```python
config = {
    'displayModeBar': True,
    'displaylogo': False,
    'modeBarButtonsToRemove': ['select2d', 'lasso2d'],
    'toImageButtonOptions': {
        'format': 'png',
        'filename': f'equity_curve_{strategy_name}',
        'height': 800,
        'width': 1400,
        'scale': 2
    }
}

st.plotly_chart(fig, use_container_width=True, config=config)
```

---

## ğŸ“Š æœˆåº¦å ±é…¬ç†±åŠ›åœ–è¦æ ¼

### è³‡æ–™ä¾†æºèˆ‡è¨ˆç®—

```python
# å¾ BacktestResult è¼‰å…¥æ—¥å ±é…¬
daily_returns = load_daily_returns(experiment_id)
# é æœŸæ ¼å¼: pd.Series
#   Index: DatetimeIndex (æ—¥æœŸ)
#   Values: float (æ—¥å ±é…¬ç‡ï¼Œå°æ•¸å½¢å¼å¦‚ 0.02 = 2%)

# æŒ‰æœˆèšåˆï¼ˆè¤‡åˆ©è¨ˆç®—ï¼‰
monthly_returns = daily_returns.resample('M').apply(
    lambda x: (1 + x).prod() - 1
) * 100  # è½‰ç‚ºç™¾åˆ†æ¯”

# è½‰ç‚ºç†±åŠ›åœ–æ ¼å¼ï¼ˆå¹´ x æœˆï¼‰
pivot_data = monthly_returns.to_frame('return')
pivot_data['year'] = pivot_data.index.year
pivot_data['month'] = pivot_data.index.month
heatmap_matrix = pivot_data.pivot_table(
    values='return',
    index='year',
    columns='month',
    fill_value=0
)
```

### Plotly é…ç½®

```python
import plotly.graph_objects as go

# æœˆä»½æ¨™ç±¤
month_labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun',
                'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec']

fig = go.Figure(data=go.Heatmap(
    z=heatmap_matrix.values,
    x=month_labels,
    y=heatmap_matrix.index.astype(str),  # å¹´ä»½
    colorscale='RdYlGn',  # ç´…-é»ƒ-ç¶ 
    zmid=0,  # ä¸­å¿ƒé»è¨­ç‚º 0ï¼ˆé»ƒè‰²ï¼‰
    text=heatmap_matrix.values,
    texttemplate='%{text:.1f}%',
    textfont=dict(size=12, weight=500),
    colorbar=dict(
        title='å ±é…¬ç‡ (%)',
        titlefont=dict(size=12),
        tickfont=dict(size=10),
        thickness=15,
        len=0.7
    ),
    hovertemplate='<b>%{y} %{x}</b><br>' +
                  'å ±é…¬ç‡: %{z:.2f}%<br>' +
                  '<extra></extra>'
))

# ä½ˆå±€é…ç½®
fig.update_layout(
    title=dict(
        text='æœˆåº¦å ±é…¬ç†±åŠ›åœ–',
        font=dict(size=18, weight=600, color='#111827')
    ),
    xaxis=dict(
        title='',
        side='bottom',
        tickfont=dict(size=12),
        range=get_month_range_for_date_filter(st.session_state.chart_xrange)  # æ ¹æ“šé¸æ“‡ç¯„åœç¯©é¸æœˆä»½
    ),
    yaxis=dict(
        title='å¹´ä»½',
        tickfont=dict(size=12)
    ),
    height=200,
    margin=dict(l=60, r=40, t=60, b=40),
    plot_bgcolor='white',
    paper_bgcolor='white'
)
```

### Hover Tooltip è¦æ ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2024 May          â”‚
â”‚ å ±é…¬ç‡: 5.23%      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è‰²å½©æ˜ å°„é‚è¼¯

```python
# Plotly 'RdYlGn' colorscale è‡ªå‹•æ˜ å°„
# è² å€¼ç¯„åœ â†’ ç´…è‰²ç³»ï¼ˆ#ef4444 ç›¸è¿‘ï¼‰
# æ¥è¿‘ 0   â†’ é»ƒè‰²ç³»ï¼ˆ#eab308 ç›¸è¿‘ï¼‰
# æ­£å€¼ç¯„åœ â†’ ç¶ è‰²ç³»ï¼ˆ#22c55e ç›¸è¿‘ï¼‰

# zmid=0 ç¢ºä¿ 0% å°æ‡‰é»ƒè‰²ä¸­å¿ƒ
```

### æ™‚é–“ç¯„åœç¯©é¸é‚è¼¯

```python
def get_month_range_for_date_filter(date_range):
    """æ ¹æ“šæ—¥æœŸç¯„åœç¯©é¸è¦é¡¯ç¤ºçš„æœˆä»½"""
    start_date, end_date = date_range

    # è¨ˆç®—æœˆä»½ç¯„åœ
    start_month = start_date.month
    end_month = end_date.month
    start_year = start_date.year
    end_year = end_date.year

    # å¦‚æœè·¨å¹´ï¼Œé¡¯ç¤ºæ‰€æœ‰æœˆä»½
    if start_year != end_year:
        return None  # ä¸è¨­é™åˆ¶

    # åŒä¸€å¹´å…§ï¼Œåƒ…é¡¯ç¤ºç¯„åœå…§æœˆä»½ï¼ˆPlotly ä¸ç›´æ¥æ”¯æ´ï¼Œæ”¹ç”¨ x è»¸ç¯„åœï¼‰
    # å¯¦ä½œæ™‚å¯é¸æ“‡éæ¿¾è³‡æ–™æˆ–ä½¿ç”¨è¦–è¦ºæç¤º
    return None  # ç°¡åŒ–å¯¦ä½œï¼šç¸½æ˜¯é¡¯ç¤ºå…¨éƒ¨æœˆä»½
```

> **Note**: ç†±åŠ›åœ–çš„æ™‚é–“ç¯©é¸è¼ƒè¤‡é›œï¼Œå»ºè­°ç°¡åŒ–ç‚ºã€Œåªè¦æ—¥æœŸç¯„åœåŒ…å«è©²æœˆï¼Œå°±é¡¯ç¤ºè©²æœˆã€ï¼Œæˆ–ç¸½æ˜¯é¡¯ç¤ºå…¨éƒ¨æœˆä»½ã€‚

---

## ğŸš¨ éŒ¯èª¤è™•ç†

### æ•¸æ“šè¼‰å…¥éŒ¯èª¤

```python
try:
    equity_curve = load_equity_curve(experiment_id)
except FileNotFoundError:
    st.error("""
    âŒ **æ¬Šç›Šæ›²ç·šæ•¸æ“šä¸å­˜åœ¨**

    å¯¦é©— ID: {experiment_id}

    **å»ºè­°**ï¼šæª¢æŸ¥å¯¦é©—è¨˜éŒ„æˆ–é‡æ–°åŸ·è¡Œå›æ¸¬ã€‚
    """)
    st.stop()
except Exception as e:
    st.error(f"""
    âŒ **è¼‰å…¥æ¬Šç›Šæ›²ç·šå¤±æ•—**

    éŒ¯èª¤è¨Šæ¯: {str(e)}

    è«‹è¯çµ¡æŠ€è¡“æ”¯æ´æˆ–æª¢æŸ¥æ•¸æ“šå®Œæ•´æ€§ã€‚
    """)
    st.stop()
```

### æ•¸æ“šæ ¼å¼éŒ¯èª¤

```python
# é©—è­‰æ•¸æ“šæ ¼å¼
if not isinstance(equity_curve.index, pd.DatetimeIndex):
    st.error("âŒ æ¬Šç›Šæ›²ç·šç´¢å¼•å¿…é ˆç‚ºæ—¥æœŸæ ¼å¼")
    st.stop()

if equity_curve.isnull().any():
    st.warning("âš ï¸ æ¬Šç›Šæ›²ç·šåŒ…å«ç¼ºå¤±å€¼ï¼Œå·²è‡ªå‹•å¡«å……")
    equity_curve = equity_curve.fillna(method='ffill')
```

### ç©ºæ•¸æ“šè™•ç†

```python
if len(equity_curve) == 0:
    st.info("""
    ğŸ“Š **ç„¡æ¬Šç›Šæ›²ç·šæ•¸æ“š**

    æ­¤ç­–ç•¥å¯¦é©—æœªç”¢ç”Ÿäº¤æ˜“è¨˜éŒ„ã€‚

    **å¯èƒ½åŸå› **ï¼š
    - ç­–ç•¥æ¢ä»¶æœªè§¸ç™¼
    - å›æ¸¬æœŸé–“éçŸ­
    - ç­–ç•¥åƒæ•¸è¨­å®šéŒ¯èª¤
    """)
    st.stop()
```

---

## ğŸ¯ å®Œæ•´å¯¦ä½œç¯„ä¾‹

### Python ç¨‹å¼ç¢¼çµæ§‹

```python
def render_strategy_detail_charts(strategy_data: dict):
    """
    æ¸²æŸ“ç­–ç•¥è©³æƒ…åœ–è¡¨å€åŸŸ

    Args:
        strategy_data: ç­–ç•¥è³‡æ–™ï¼ˆåŒ…å« experiment_idï¼‰
    """

    # 1. è¼‰å…¥æ•¸æ“š
    experiment_id = strategy_data['experiment_id']

    try:
        equity_curve = load_equity_curve(experiment_id)
        daily_returns = load_daily_returns(experiment_id)
    except Exception as e:
        st.error(f"âŒ è¼‰å…¥æ•¸æ“šå¤±æ•—: {str(e)}")
        return

    # 2. æ•¸æ“šé©—è­‰
    if len(equity_curve) == 0:
        st.info("ğŸ“Š ç„¡æ¬Šç›Šæ›²ç·šæ•¸æ“š")
        return

    # 3. æ™‚é–“ç¯„åœé¸æ“‡å™¨
    min_date = equity_curve.index.min().date()
    max_date = equity_curve.index.max().date()

    # åˆå§‹åŒ– session_state
    if 'chart_xrange' not in st.session_state:
        st.session_state.chart_xrange = (min_date, max_date)

    # æ¸²æŸ“é¸æ“‡å™¨
    col_slider, col_reset = st.columns([4, 1])

    with col_slider:
        date_range = st.slider(
            "é¸æ“‡æ™‚é–“ç¯„åœ",
            min_value=min_date,
            max_value=max_date,
            value=st.session_state.chart_xrange,
            format="YYYY-MM-DD",
            key=f"date_range_{experiment_id}"
        )

    with col_reset:
        st.markdown("<div style='padding-top: 1.5rem;'></div>", unsafe_allow_html=True)
        if st.button("ğŸ”„ é‡ç½®ç¯„åœ", key=f"reset_{experiment_id}"):
            st.session_state.chart_xrange = (min_date, max_date)
            st.rerun()

    # æ›´æ–° session_state
    st.session_state.chart_xrange = date_range

    # 4. ç¯©é¸æ•¸æ“šï¼ˆæ ¹æ“šæ™‚é–“ç¯„åœï¼‰
    equity_filtered = equity_curve.loc[
        (equity_curve.index.date >= date_range[0]) &
        (equity_curve.index.date <= date_range[1])
    ]

    # 5. ç¹ªè£½æ¬Šç›Šæ›²ç·š
    equity_fig = plot_equity_curve(equity_filtered, strategy_data['strategy_name'])
    st.plotly_chart(equity_fig, use_container_width=True, key=f"equity_{experiment_id}")

    # 6. ç¹ªè£½æœˆåº¦å ±é…¬ç†±åŠ›åœ–
    monthly_fig = plot_monthly_heatmap(daily_returns, date_range, strategy_data['strategy_name'])
    st.plotly_chart(monthly_fig, use_container_width=True, key=f"monthly_{experiment_id}")


def plot_equity_curve(equity_curve: pd.Series, strategy_name: str) -> go.Figure:
    """ç¹ªè£½æ¬Šç›Šæ›²ç·š"""
    fig = go.Figure()

    # [å®Œæ•´å¯¦ä½œå¦‚ä¸Šè¿°è¦æ ¼]

    return fig


def plot_monthly_heatmap(daily_returns: pd.Series, date_range: tuple, strategy_name: str) -> go.Figure:
    """ç¹ªè£½æœˆåº¦å ±é…¬ç†±åŠ›åœ–"""
    # æŒ‰æœˆèšåˆ
    monthly_returns = daily_returns.resample('M').apply(
        lambda x: (1 + x).prod() - 1
    ) * 100

    # [å®Œæ•´å¯¦ä½œå¦‚ä¸Šè¿°è¦æ ¼]

    return fig
```

---

## ğŸ“ Checklist

### è¨­è¨ˆå®Œæ•´æ€§
- [x] éµå¾ª 60-30-10 è‰²å½©æ³•å‰‡
- [x] Token å¼•ç”¨æ­£ç¢ºï¼ˆstyles.pyï¼‰
- [x] æ‰€æœ‰äº’å‹•å…ƒç´ æœ‰æ˜ç¢ºç‹€æ…‹
- [x] éŸ¿æ‡‰å¼è¨­è¨ˆè€ƒé‡
- [x] è¼‰å…¥/éŒ¯èª¤/ç©ºç‹€æ…‹è™•ç†

### UX åŸå‰‡æ‡‰ç”¨
- [x] Miller's Law: æ¯å€‹åœ–è¡¨å–®ä¸€ç„¦é»
- [x] Jakob's Law: éµå¾ª Plotly/Streamlit æ…£ä¾‹
- [x] Fitts's Law: æ™‚é–“é¸æ“‡å™¨æ˜“æ“ä½œ
- [x] Gestalt Principles: è¦–è¦ºåˆ†çµ„æ¸…æ™°
- [x] å³æ™‚å›é¥‹: Hover tooltip å³æ™‚é¡¯ç¤º

### æŠ€è¡“å¯¦ä½œ
- [x] ä½¿ç”¨ `get_common_css()` è¼‰å…¥æ¨£å¼
- [x] åœ–è¡¨é…ç½®çµ±ä¸€ï¼ˆPlotly themeï¼‰
- [x] æ™‚é–“ç¯„åœåŒæ­¥æ©Ÿåˆ¶æ¸…æ™°
- [x] æ•¸å€¼æ ¼å¼åŒ–ä¸€è‡´
- [x] éŒ¯èª¤è™•ç†å®Œæ•´

---

## ğŸ“ é–‹ç™¼è€…æ³¨æ„äº‹é …

### å¾è¨­è¨ˆåˆ°ç¨‹å¼ç¢¼

1. **è®€å–ç¾æœ‰æ¨£å¼**
   ```python
   from ui.styles import get_common_css
   st.markdown(get_common_css(), unsafe_allow_html=True)
   ```

2. **ä½¿ç”¨ CSS Variablesï¼ˆä¸è¦ hardcodeï¼‰**
   ```python
   # âŒ éŒ¯èª¤
   line_color = "#2563eb"

   # âœ… æ­£ç¢ºï¼ˆåœ¨è¨»è§£ä¸­èªªæ˜å°æ‡‰ tokenï¼‰
   line_color = '#2563eb'  # --color-primary from styles.py
   ```

3. **åœ–è¡¨é¡è‰²ä¸€è‡´æ€§**
   ```python
   # æ‰€æœ‰åœ–è¡¨ä½¿ç”¨ç›¸åŒé¡è‰²å®šç¾©
   CHART_COLORS = {
       'primary_line': '#2563eb',  # --color-primary
       'success': '#22c55e',        # --color-success
       'error': '#ef4444',          # --color-error
   }
   ```

4. **æ™‚é–“ç¯„åœåŒæ­¥**
   ```python
   # ä½¿ç”¨ session_state è·¨åœ–è¡¨å…±äº«
   st.session_state.chart_xrange = (start_date, end_date)

   # æ‰€æœ‰åœ–è¡¨æ‡‰ç”¨
   fig.update_xaxes(range=st.session_state.chart_xrange)
   ```

### è³‡æ–™çµæ§‹é æœŸ

```python
# equity_curve: pd.Series
# Index: DatetimeIndex
# Values: float (ç´¯ç©æ¬Šç›Šï¼Œå¦‚ 10000, 10200, 10150...)
equity_curve = pd.Series(
    data=[10000, 10200, 10150, 10300, ...],
    index=pd.date_range('2024-01-01', periods=100, freq='D')
)

# daily_returns: pd.Series
# Index: DatetimeIndex
# Values: float (æ—¥å ±é…¬ç‡å°æ•¸ï¼Œå¦‚ 0.02 = 2%)
daily_returns = pd.Series(
    data=[0.02, -0.005, 0.015, ...],
    index=pd.date_range('2024-01-01', periods=100, freq='D')
)
```

---

## ğŸ”— ç›¸é—œè¦ç¯„

- **Design Tokens**: `~/.claude/skills/ui/references/tokens.md`
- **Component Specs**: `~/.claude/skills/ui/references/components.md`
- **UX Patterns**: `~/.claude/skills/ux/references/patterns.md`
- **Psychology**: `~/.claude/skills/ux/references/psychology.md`
- **ç¾æœ‰æ¨£å¼**: `/ui/styles.py`
- **åƒè€ƒè¦æ ¼**: `/openspec/changes/archive/.../ui-specs/validation-page.md`
- **ç•¶å‰é é¢**: `/ui/pages/2_Strategies.py`
