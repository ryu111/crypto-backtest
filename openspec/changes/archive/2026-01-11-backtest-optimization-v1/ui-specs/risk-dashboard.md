# é¢¨éšªç®¡ç†å„€è¡¨æ¿ UI è¨­è¨ˆè¦æ ¼

> æª”æ¡ˆï¼š`ui/pages/5_RiskDashboard.py`
> è¨­è¨ˆæ—¥æœŸï¼š2026-01-11
> è¨­è¨ˆè€…ï¼šDESIGNER Agent

---

## ğŸ“‹ éœ€æ±‚ç†è§£

### ç›®æ¨™
å»ºç«‹ä¸€å€‹å°ˆæ¥­çš„é¢¨éšªç®¡ç†å„€è¡¨æ¿ï¼Œè®“äº¤æ˜“è€…èƒ½å¤ ï¼š
1. **è©•ä¼°éƒ¨ä½å¤§å°**ï¼šä½¿ç”¨ Kelly Criterion æ±ºå®šæœ€ä½³è³‡é‡‘é…ç½®
2. **åˆ†æç­–ç•¥ç›¸é—œæ€§**ï¼šäº†è§£å¤šç­–ç•¥çµ„åˆçš„åˆ†æ•£æ•ˆæœ
3. **å„ªåŒ–æŠ•è³‡çµ„åˆ**ï¼šæ‰¾åˆ°é¢¨éšªèª¿æ•´å¾Œçš„æœ€ä½³æ¬Šé‡é…ç½®
4. **ç›£æ§é¢¨éšªæŒ‡æ¨™**ï¼šè¿½è¹¤ VaRã€CVaRã€MaxDD ç­‰é—œéµé¢¨éšªæŒ‡æ¨™

### ä½¿ç”¨è€…
- **ç›®æ¨™æ—ç¾¤**ï¼šé‡åŒ–äº¤æ˜“è€…ã€ç­–ç•¥åˆ†æå¸«
- **å°ˆæ¥­ç¨‹åº¦**ï¼šç†Ÿæ‚‰é‡‘èè¡“èªï¼ˆSharpe Ratioã€VaRã€Kelly Criterionï¼‰
- **ä½¿ç”¨æƒ…å¢ƒ**ï¼šç­–ç•¥ä¸Šç·šå‰çš„é¢¨éšªè©•ä¼°ã€çµ„åˆé…ç½®æ±ºç­–
- **è£ç½®**ï¼šä¸»è¦åœ¨æ¡Œé¢ç«¯ä½¿ç”¨ï¼ˆå¯¬è¢å¹•ï¼‰

### é—œéµäº’å‹•
- é¸æ“‡ç­–ç•¥ï¼šå¤šé¸æ¸…å–®ï¼ŒæŸ¥çœ‹é¸ä¸­ç­–ç•¥çš„çµ„åˆé¢¨éšª
- èª¿æ•´åƒæ•¸ï¼šKelly æ¯”ä¾‹ï¼ˆFull/Half/Quarterï¼‰ã€æ™‚é–“çª—å£
- æŸ¥çœ‹ç´°ç¯€ï¼šé»æ“Šåœ–è¡¨æŸ¥çœ‹è©³ç´°æ•¸å€¼
- åŒ¯å‡ºå ±å‘Šï¼šä¸‹è¼‰é¢¨éšªåˆ†æå ±å‘Šï¼ˆæœªä¾†åŠŸèƒ½ï¼‰

---

## ğŸ¨ è¨­è¨ˆåŸå‰‡

### è³‡æ–™å¯†é›†é é¢
æ­¤é é¢å±¬æ–¼**è³‡æ–™å¯†é›†å‹**ä»‹é¢ï¼Œéµå¾ªä»¥ä¸‹åŸå‰‡ï¼š

1. **æ¸…æ™°çš„è¦–è¦ºå±¤ç´š**ï¼ˆHick's Lawï¼‰
   - ä½¿ç”¨å¡ç‰‡å€éš”ä¸åŒåˆ†æå€å¡Š
   - æ¯å€‹å€å¡Šæœ‰æ˜ç¢ºæ¨™é¡Œå’Œèªªæ˜

2. **åˆ†å¡Šå‘ˆç¾**ï¼ˆMiller's Lawï¼‰
   - 4 å€‹ä¸»è¦å€å¡Šï¼ˆKelly / ç›¸é—œæ€§ / çµ„åˆå„ªåŒ– / é¢¨éšªæŒ‡æ¨™ï¼‰
   - æ¯å€‹å€å¡Šå…§æœ€å¤š 3-4 å€‹å­é …ç›®

3. **å°ˆæ¥­ä½†æ˜“æ‡‚**ï¼ˆCognitive Load Theoryï¼‰
   - æä¾› tooltips è§£é‡‹å°ˆæ¥­è¡“èª
   - ä½¿ç”¨è¦–è¦ºåŒ–é™ä½æ•¸å­—ç–²å‹
   - é‡è¦æ•¸å€¼çªå‡ºé¡¯ç¤º

4. **å³æ™‚å›é¥‹**ï¼ˆPeak-End Ruleï¼‰
   - é¸æ“‡ç­–ç•¥å¾Œç«‹å³æ›´æ–°æ‰€æœ‰åœ–è¡¨
   - è¼‰å…¥ç‹€æ…‹ä½¿ç”¨ skeleton screen
   - å®Œæˆè¨ˆç®—å¾Œé¡¯ç¤ºæ‘˜è¦å¡ç‰‡

---

## ğŸ“ LAYOUTï¼ˆä½ˆå±€çµæ§‹ï¼‰

### æ•´é«”æ¶æ§‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ›¡ï¸ é¢¨éšªç®¡ç†å„€è¡¨æ¿                                       â”‚ â† H1 Title
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [ç­–ç•¥é¸æ“‡å™¨ (å¤šé¸)] [æ™‚é–“çª—å£] [Kelly é¡å‹] [é‡æ–°è¨ˆç®—]  â”‚ â† Controls
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ å»ºè­°éƒ¨ä½: 25%   â”‚ çµ„åˆ Sharpe: 1.8â”‚ åˆ†æ•£æ¯”ç‡: 0.35  â”‚ â”‚ â† Summary Metrics
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Tab 1: Kelly Criterion | Tab 2: ç›¸é—œæ€§ | Tab 3: å„ªåŒ– | Tab 4: é¢¨éšªæŒ‡æ¨™
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [Tab Content - å‹•æ…‹è¼‰å…¥]                                â”‚
â”‚                                                           â”‚
â”‚                                                           â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Streamlit Layout çµæ§‹

```python
# 1. æ¨™é¡Œå€
st.title("ğŸ›¡ï¸ é¢¨éšªç®¡ç†å„€è¡¨æ¿")
st.markdown("---")

# 2. æ§åˆ¶å€ï¼ˆä½¿ç”¨ columnsï¼‰
col1, col2, col3, col4 = st.columns([3, 1, 1, 1])
with col1:
    strategies = st.multiselect("é¸æ“‡ç­–ç•¥")
with col2:
    window = st.selectbox("æ™‚é–“çª—å£", [30, 60, 90])
with col3:
    kelly_type = st.radio("Kelly é¡å‹", ["Full", "Half", "Quarter"])
with col4:
    st.button("é‡æ–°è¨ˆç®—")

# 3. æ‘˜è¦æŒ‡æ¨™ï¼ˆ5 å€‹æ ¸å¿ƒæŒ‡æ¨™ï¼‰
col1, col2, col3, col4, col5 = st.columns(5)
# ... metrics

# 4. Tabs å…§å®¹å€
tab1, tab2, tab3, tab4 = st.tabs([
    "ğŸ“Š Kelly Criterion",
    "ğŸ”— ç›¸é—œæ€§åˆ†æ",
    "âš–ï¸ çµ„åˆå„ªåŒ–",
    "ğŸ“‰ é¢¨éšªæŒ‡æ¨™"
])
```

### é–“è·ç³»çµ±

| å€åŸŸ | é–“è· Token | å¯¦éš›å€¼ | èªªæ˜ |
|------|-----------|--------|------|
| æ¨™é¡Œä¸‹æ–¹åˆ†éš”ç·š | `st.markdown("---")` | - | Streamlit é è¨­ |
| æ§åˆ¶å€èˆ‡æŒ‡æ¨™å€ | `spacing-md` | 16px | å€å¡Šé–“è· |
| æŒ‡æ¨™å¡ç‰‡é–“è· | `gap-inline` | 8px | Streamlit columns é è¨­ |
| Tab å…§å®¹ä¸Šæ–¹ | `spacing-lg` | 24px | è¦–è¦ºå‘¼å¸ç©ºé–“ |
| å¡ç‰‡å…§éƒ¨ padding | `padding-card` | 24px | ä½¿ç”¨ Streamlit container |

---

## ğŸ¨ VISUALï¼ˆè¦–è¦ºè¨­è¨ˆï¼‰

### è‰²å½©æ–¹æ¡ˆ

**60-30-10 æ³•å‰‡æ‡‰ç”¨**ï¼š
- **60% ä¸»è‰²**ï¼š`--color-surface` (#ffffff) - èƒŒæ™¯
- **30% æ¬¡è‰²**ï¼š`--color-surface-raised` (#f9fafb) - å¡ç‰‡ã€å®¹å™¨
- **10% å¼·èª¿è‰²**ï¼š`--color-primary` (#2563eb) - ä¸»è¦æŒ‰éˆ•ã€åœ–è¡¨ä¸»ç·š

### åŠŸèƒ½è‰²æ‡‰ç”¨

| å…ƒç´  | è‰²å½© Token | ç”¨é€” |
|------|-----------|------|
| **Kelly Criterion** | `--color-success` (#22c55e) | Full Kelly ç·šæ¢ |
| **Kelly Criterion** | `--color-warning` (#eab308) | Half Kelly ç·šæ¢ |
| **Kelly Criterion** | `--color-info` (#3b82f6) | Quarter Kelly ç·šæ¢ |
| **ç›¸é—œæ€§ç†±åœ–** | æ¼¸å±¤ | ç´… (é«˜ç›¸é—œ) â†’ è— (ä½ç›¸é—œ) |
| **æ•ˆç‡å‰ç·£** | `--primitive-blue-600` | å‰ç·£æ›²ç·š |
| **æœ€å¤§ Sharpe é»** | `--color-success` | æ¨™è¨˜é» |
| **é¢¨éšªå¹³åƒ¹é»** | `--color-warning` | æ¨™è¨˜é» |
| **VaR å€é–“** | `--color-error-light` (#fef2f2) | å¡«å……å€åŸŸ |

### åœ–è¡¨é…è‰²

```python
# Plotly é…è‰²æ–¹æ¡ˆï¼ˆç¬¦åˆ Design Tokensï¼‰
CHART_COLORS = {
    'primary': '#2563eb',      # --primitive-blue-600
    'success': '#22c55e',      # --primitive-green-500
    'warning': '#eab308',      # --primitive-yellow-500
    'error': '#ef4444',        # --primitive-red-500
    'secondary': '#6b7280',    # --primitive-gray-500

    # ç›¸é—œæ€§ç†±åœ–æ¼¸å±¤
    'heatmap': ['#3b82f6', '#93c5fd', '#f3f4f6', '#fca5a5', '#ef4444'],

    # æ•ˆç‡å‰ç·£æ¼¸å±¤
    'frontier': ['#dbeafe', '#3b82f6', '#1e40af']
}

# Plotly layout åŸºç¤é…ç½®
PLOTLY_LAYOUT = {
    'font': {'family': 'Inter, sans-serif', 'size': 14},
    'plot_bgcolor': '#ffffff',
    'paper_bgcolor': '#ffffff',
    'margin': {'l': 60, 'r': 40, 't': 60, 'b': 60},
    'hovermode': 'closest'
}
```

### å¡ç‰‡èˆ‡å®¹å™¨

```python
# Streamlit åŸç”Ÿæ”¯æ´ï¼Œä½¿ç”¨ CSS èª¿æ•´
st.markdown("""
<style>
/* å¡ç‰‡å®¹å™¨ */
.stContainer {
    background: var(--color-surface-raised);
    border-radius: var(--primitive-radius-lg);  /* 8px */
    padding: var(--padding-card);  /* 24px */
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
}

/* æŒ‡æ¨™å¡ç‰‡ */
.stMetric {
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--primitive-radius-md);  /* 6px */
    padding: var(--spacing-md);  /* 16px */
}

/* Tabs */
.stTabs [data-baseweb="tab-list"] {
    gap: var(--spacing-sm);  /* 8px */
}

.stTabs [data-baseweb="tab"] {
    border-radius: var(--primitive-radius-md) var(--primitive-radius-md) 0 0;
    padding: var(--spacing-sm) var(--spacing-md);
    font-weight: var(--primitive-font-medium);
}
</style>
""", unsafe_allow_html=True)
```

### åœ“è§’ç³»çµ±

| å…ƒç´  | åœ“è§’ Token | å¯¦éš›å€¼ |
|------|-----------|--------|
| å°æŒ‰éˆ•ã€Badge | `--primitive-radius-sm` | 2px |
| è¼¸å…¥æ¡†ã€é¸æ“‡å™¨ | `--primitive-radius-md` | 6px |
| å¡ç‰‡ | `--primitive-radius-lg` | 8px |
| Modal (æœªä¾†) | `--primitive-radius-xl` | 12px |

---

## ğŸ”„ STATESï¼ˆäº’å‹•ç‹€æ…‹ï¼‰

### é é¢ç‹€æ…‹

| ç‹€æ…‹ | è¦–è¦ºè¡¨ç¾ | è§¸ç™¼æ¢ä»¶ |
|------|----------|----------|
| **Empty** | ç©ºç‹€æ…‹æ’åœ– + å¼•å°æ–‡å­— | æœªé¸æ“‡ä»»ä½•ç­–ç•¥ |
| **Loading** | Skeleton screen + Spinner | è¨ˆç®—ä¸­ |
| **Success** | å®Œæ•´åœ–è¡¨ + æ•¸æ“š | è¨ˆç®—å®Œæˆ |
| **Error** | éŒ¯èª¤è¨Šæ¯ + å»ºè­° | è¨ˆç®—å¤±æ•— |
| **Partial** | éƒ¨åˆ†æ•¸æ“š + è­¦å‘Š | è³‡æ–™ä¸è¶³ |

### Empty State è¨­è¨ˆ

```python
if len(selected_strategies) == 0:
    st.info("""
    ### ğŸ‘‹ é–‹å§‹åˆ†æ

    è«‹å¾ä¸Šæ–¹é¸æ“‡è‡³å°‘ä¸€å€‹ç­–ç•¥ä¾†æŸ¥çœ‹é¢¨éšªåˆ†æã€‚

    **å»ºè­°**ï¼š
    - é¸æ“‡ 2-5 å€‹ç­–ç•¥ä»¥ç²å¾—æœ‰æ„ç¾©çš„ç›¸é—œæ€§åˆ†æ
    - ç¢ºä¿ç­–ç•¥æœ‰è¶³å¤ çš„æ­·å²äº¤æ˜“è¨˜éŒ„ï¼ˆâ‰¥30 ç­†ï¼‰
    """)
    st.stop()
```

### Loading State è¨­è¨ˆ

```python
with st.spinner("æ­£åœ¨è¨ˆç®—é¢¨éšªæŒ‡æ¨™..."):
    # ä½¿ç”¨ placeholder é¡¯ç¤º skeleton
    placeholder = st.empty()
    with placeholder.container():
        st.markdown("### â³ è¨ˆç®—ä¸­...")
        # Streamlit è‡ªå¸¶çš„ spinner å·²è¶³å¤ 

    # åŸ·è¡Œè¨ˆç®—
    results = calculate_risk_metrics(strategies)

    # æ¸…é™¤ placeholderï¼Œé¡¯ç¤ºçµæœ
    placeholder.empty()
```

### Error State è¨­è¨ˆ

```python
try:
    results = calculate_risk_metrics(strategies)
except InsufficientDataError as e:
    st.error(f"""
    âŒ **è³‡æ–™ä¸è¶³**

    {str(e)}

    **å»ºè­°**ï¼š
    - ç¢ºä¿ç­–ç•¥è‡³å°‘æœ‰ 30 ç­†äº¤æ˜“è¨˜éŒ„
    - æª¢æŸ¥å›æ¸¬æ™‚é–“ç¯„åœæ˜¯å¦è¶³å¤ 
    """)
    st.stop()
except Exception as e:
    st.error(f"è¨ˆç®—å¤±æ•—ï¼š{str(e)}")
    logger.exception("Risk metrics calculation failed")
    st.stop()
```

### æ§åˆ¶å…ƒä»¶ç‹€æ…‹

```python
# å¤šé¸æ¸…å–®
strategies = st.multiselect(
    "é¸æ“‡ç­–ç•¥",
    options=available_strategies,
    default=[],
    help="è‡³å°‘é¸æ“‡ 1 å€‹ç­–ç•¥ï¼Œå»ºè­° 2-5 å€‹ä»¥åˆ†æç›¸é—œæ€§"
)

# é‡æ–°è¨ˆç®—æŒ‰éˆ•ï¼ˆå¸¶è¼‰å…¥ç‹€æ…‹ï¼‰
if st.button("ğŸ”„ é‡æ–°è¨ˆç®—", use_container_width=False):
    st.rerun()  # Streamlit é‡æ–°åŸ·è¡Œè…³æœ¬

# åƒæ•¸é¸æ“‡å™¨ï¼ˆå¸¶èªªæ˜ï¼‰
kelly_type = st.radio(
    "Kelly Criterion é¡å‹",
    options=["Full Kelly", "Half Kelly", "Quarter Kelly"],
    index=1,  # é è¨­ Half Kelly (æ›´ä¿å®ˆ)
    help="""
    - **Full Kelly**: æœ€å¤§åŒ–æˆé•·ï¼Œä½†æ³¢å‹•è¼ƒå¤§
    - **Half Kelly**: å¹³è¡¡æˆé•·èˆ‡æ³¢å‹•ï¼ˆæ¨è–¦ï¼‰
    - **Quarter Kelly**: æ¥µä¿å®ˆï¼Œæ³¢å‹•æœ€å°
    """
)
```

---

## ğŸ“Š COMPONENT SPECSï¼ˆå…ƒä»¶è¦æ ¼ï¼‰

### Tab 1: Kelly Criterion

#### ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š Kelly Criterion éƒ¨ä½ç®¡ç†                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Full Kelly: 32% â”‚ Half Kelly: 16% â”‚Quarter Kelly:8% â”‚ â”‚
â”‚ â”‚ $32,000         â”‚ $16,000 â­      â”‚ $8,000          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [éƒ¨ä½å¤§å° vs ç ´ç”¢é¢¨éšªæ›²ç·šåœ–]                             â”‚
â”‚                                                           â”‚
â”‚  - X è»¸ï¼šè³‡é‡‘æ¯”ä¾‹ (0% - 100%)                            â”‚
â”‚  - Y è»¸å·¦ï¼šé æœŸæˆé•·ç‡                                     â”‚
â”‚  - Y è»¸å³ï¼šç ´ç”¢é¢¨éšª                                       â”‚
â”‚  - æ¨™è¨˜ï¼šFull/Half/Quarter Kelly ä½ç½®                    â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [ç­–ç•¥å‹ç‡èˆ‡ç›ˆè™§æ¯”åˆ†æè¡¨æ ¼]                               â”‚
â”‚                                                           â”‚
â”‚  | ç­–ç•¥    | å‹ç‡  | ç›ˆè™§æ¯” | Full Kelly | Half Kelly |  â”‚
â”‚  |---------|-------|--------|------------|------------|  â”‚
â”‚  | Trend A | 55%   | 1.8    | 35%        | 17.5%      |  â”‚
â”‚  | Mean B  | 48%   | 2.2    | 28%        | 14%        |  â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœ–è¡¨è¦æ ¼

```python
def render_kelly_curve(kelly_results: Dict):
    """
    Kelly Criterion æ›²ç·šåœ–

    é¡¯ç¤ºï¼š
    1. æˆé•·ç‡ vs è³‡é‡‘æ¯”ä¾‹æ›²ç·š
    2. ç ´ç”¢é¢¨éšª vs è³‡é‡‘æ¯”ä¾‹æ›²ç·š
    3. æ¨™è¨˜ Full/Half/Quarter Kelly ä½ç½®
    """
    fig = go.Figure()

    # X è»¸ï¼šè³‡é‡‘æ¯”ä¾‹ (0% - 100%)
    fractions = np.linspace(0, 1, 100)

    # Y è»¸å·¦ï¼šé æœŸæˆé•·ç‡æ›²ç·šï¼ˆå°æ•¸æˆé•·ï¼‰
    fig.add_trace(go.Scatter(
        x=fractions * 100,
        y=growth_rate,
        name='é æœŸæˆé•·ç‡',
        line=dict(color='#2563eb', width=3),
        yaxis='y'
    ))

    # Y è»¸å³ï¼šç ´ç”¢é¢¨éšªæ›²ç·š
    fig.add_trace(go.Scatter(
        x=fractions * 100,
        y=ruin_risk,
        name='ç ´ç”¢é¢¨éšª',
        line=dict(color='#ef4444', width=2, dash='dot'),
        yaxis='y2'
    ))

    # æ¨™è¨˜ Full Kelly
    fig.add_vline(
        x=kelly_results['full'] * 100,
        line_dash="dash",
        line_color="#22c55e",
        annotation_text="Full Kelly",
        annotation_position="top"
    )

    # æ¨™è¨˜ Half Kelly (æ¨è–¦)
    fig.add_vline(
        x=kelly_results['half'] * 100,
        line_dash="solid",
        line_color="#eab308",
        line_width=3,
        annotation_text="Half Kelly â­",
        annotation_position="top"
    )

    # æ¨™è¨˜ Quarter Kelly
    fig.add_vline(
        x=kelly_results['quarter'] * 100,
        line_dash="dash",
        line_color="#3b82f6",
        annotation_text="Quarter Kelly",
        annotation_position="bottom"
    )

    fig.update_layout(
        title="éƒ¨ä½å¤§å° vs é¢¨éšªæ”¶ç›Šé—œä¿‚",
        xaxis_title="è³‡é‡‘æ¯”ä¾‹ (%)",
        yaxis=dict(title="é æœŸæˆé•·ç‡ (%)", side='left'),
        yaxis2=dict(
            title="ç ´ç”¢é¢¨éšª (%)",
            side='right',
            overlaying='y',
            range=[0, 100]
        ),
        height=500,
        hovermode='x unified',
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)
```

---

### Tab 2: ç›¸é—œæ€§åˆ†æ

#### ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— ç­–ç•¥ç›¸é—œæ€§åˆ†æ                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â”‚  [ç›¸é—œæ€§çŸ©é™£ç†±åœ–]     â”‚  [æ»¾å‹•ç›¸é—œæ€§åœ–]            â”‚   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â”‚  - å°è§’ç·šç‚º 1.0      â”‚  - X è»¸ï¼šæ™‚é–“              â”‚   â”‚
â”‚ â”‚  - é¡è‰²ï¼šç´…(é«˜)â†’è—(ä½)â”‚  - Y è»¸ï¼šç›¸é—œæ€§ (-1 ~ 1)  â”‚   â”‚
â”‚ â”‚                      â”‚  - é¡¯ç¤ºè¶¨å‹¢è®ŠåŒ–             â”‚   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [å°¾éƒ¨ç›¸é—œæ€§åˆ†æå¡ç‰‡]                                     â”‚
â”‚                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚  â”‚ å·¦å°¾ (ä¸‹è·Œ) â”‚ æ­£å¸¸æ™‚æœŸ    â”‚ å³å°¾ (ä¸Šæ¼²) â”‚            â”‚
â”‚  â”‚   0.65      â”‚    0.32     â”‚    0.28     â”‚            â”‚
â”‚  â”‚   âš ï¸ é«˜     â”‚    âœ… ä½    â”‚    âœ… ä½    â”‚            â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”‚                                                           â”‚
â”‚  ğŸ’¡ **åˆ†æ**ï¼šç­–ç•¥åœ¨å¸‚å ´ä¸‹è·Œæ™‚ç›¸é—œæ€§ä¸Šå‡è‡³ 0.65ï¼Œ       â”‚
â”‚      åˆ†æ•£æ•ˆæœä¸‹é™ã€‚å»ºè­°åŠ å…¥è² ç›¸é—œç­–ç•¥ã€‚                   â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœ–è¡¨è¦æ ¼

```python
def render_correlation_heatmap(corr_matrix: pd.DataFrame):
    """ç›¸é—œæ€§çŸ©é™£ç†±åœ–"""
    fig = go.Figure(data=go.Heatmap(
        z=corr_matrix.values,
        x=corr_matrix.columns,
        y=corr_matrix.index,
        colorscale=[
            [0.0, '#3b82f6'],   # ä½ç›¸é—œï¼šè—è‰²
            [0.5, '#f3f4f6'],   # ä¸­ç­‰ï¼šç°ç™½
            [1.0, '#ef4444']    # é«˜ç›¸é—œï¼šç´…è‰²
        ],
        zmid=0,  # ä¸­å¿ƒé»ç‚º 0
        zmin=-1,
        zmax=1,
        text=corr_matrix.values,
        texttemplate='%{text:.2f}',
        textfont={"size": 12},
        colorbar=dict(
            title="ç›¸é—œä¿‚æ•¸",
            tickvals=[-1, -0.5, 0, 0.5, 1],
            ticktext=['-1.0', '-0.5', '0.0', '0.5', '1.0']
        )
    ))

    fig.update_layout(
        title="ç­–ç•¥ç›¸é—œæ€§çŸ©é™£",
        xaxis_title="ç­–ç•¥",
        yaxis_title="ç­–ç•¥",
        height=500,
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)


def render_rolling_correlation(rolling_corr: pd.DataFrame):
    """æ»¾å‹•ç›¸é—œæ€§æ™‚é–“åºåˆ—"""
    fig = go.Figure()

    # ç‚ºæ¯å°ç­–ç•¥ç¹ªè£½ä¸€æ¢ç·š
    for col in rolling_corr.columns:
        fig.add_trace(go.Scatter(
            x=rolling_corr.index,
            y=rolling_corr[col],
            name=col,
            mode='lines',
            line=dict(width=2)
        ))

    # æ·»åŠ åƒè€ƒç·š
    fig.add_hline(y=0, line_dash="dash", line_color="gray",
                  annotation_text="ç„¡ç›¸é—œ", annotation_position="right")
    fig.add_hline(y=0.5, line_dash="dot", line_color="orange",
                  annotation_text="ä¸­åº¦ç›¸é—œ", annotation_position="right")

    fig.update_layout(
        title=f"æ»¾å‹•ç›¸é—œæ€§ï¼ˆçª—å£ï¼š{window} å¤©ï¼‰",
        xaxis_title="æ—¥æœŸ",
        yaxis_title="ç›¸é—œä¿‚æ•¸",
        yaxis_range=[-1, 1],
        height=400,
        hovermode='x unified',
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)
```

---

### Tab 3: çµ„åˆå„ªåŒ–

#### ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âš–ï¸ æŠ•è³‡çµ„åˆå„ªåŒ–                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [å„ªåŒ–æ–¹æ³•é¸æ“‡]                                            â”‚
â”‚  â—‹ æœ€å¤§ Sharpe Ratio  â— é¢¨éšªå¹³åƒ¹  â—‹ æœ€å°æ³¢å‹•             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â”‚  [æ•ˆç‡å‰ç·£åœ–]         â”‚  [æ¬Šé‡é…ç½®åœ“é¤…åœ–]          â”‚   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â”‚  - X è»¸ï¼šæ³¢å‹•ç‡      â”‚  - é¡¯ç¤ºå„ç­–ç•¥ä½”æ¯”          â”‚   â”‚
â”‚ â”‚  - Y è»¸ï¼šå ±é…¬ç‡      â”‚  - æ¨™ç¤ºç™¾åˆ†æ¯”              â”‚   â”‚
â”‚ â”‚  - æ›²ç·šï¼šæ•ˆç‡å‰ç·£    â”‚                            â”‚   â”‚
â”‚ â”‚  - æ¨™è¨˜ï¼šæœ€å„ªé»      â”‚                            â”‚   â”‚
â”‚ â”‚                      â”‚                            â”‚   â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [æ¬Šé‡åˆ†é…è¡¨æ ¼]                                           â”‚
â”‚                                                           â”‚
â”‚  | ç­–ç•¥    | æœ€å¤§ Sharpe | é¢¨éšªå¹³åƒ¹ | æœ€å°æ³¢å‹• |        â”‚
â”‚  |---------|-------------|----------|----------|        â”‚
â”‚  | Trend A |    45%      |   33%    |   20%    |        â”‚
â”‚  | Mean B  |    35%      |   33%    |   50%    |        â”‚
â”‚  | Arb C   |    20%      |   34%    |   30%    |        â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  é æœŸç¸¾æ•ˆæ‘˜è¦                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ å¹´åŒ–å ±é…¬: 45%   â”‚ å¹´åŒ–æ³¢å‹•: 18%   â”‚ Sharpe: 2.5 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœ–è¡¨è¦æ ¼

```python
def render_efficient_frontier(frontier_data: Dict):
    """æ•ˆç‡å‰ç·£åœ–"""
    fig = go.Figure()

    # æ•ˆç‡å‰ç·£æ›²ç·š
    fig.add_trace(go.Scatter(
        x=frontier_data['volatility'],
        y=frontier_data['return'],
        mode='lines',
        name='æ•ˆç‡å‰ç·£',
        line=dict(color='#2563eb', width=3),
        fill='tonexty',
        fillcolor='rgba(59, 130, 246, 0.1)'
    ))

    # æœ€å¤§ Sharpe Ratio é»
    fig.add_trace(go.Scatter(
        x=[max_sharpe_vol],
        y=[max_sharpe_ret],
        mode='markers',
        name='æœ€å¤§ Sharpe',
        marker=dict(
            size=15,
            color='#22c55e',
            symbol='star',
            line=dict(color='white', width=2)
        )
    ))

    # é¢¨éšªå¹³åƒ¹é»
    fig.add_trace(go.Scatter(
        x=[risk_parity_vol],
        y=[risk_parity_ret],
        mode='markers',
        name='é¢¨éšªå¹³åƒ¹',
        marker=dict(
            size=15,
            color='#eab308',
            symbol='diamond',
            line=dict(color='white', width=2)
        )
    ))

    # ç­‰ Sharpe ç·šï¼ˆè³‡æœ¬å¸‚å ´ç·šï¼‰
    fig.add_trace(go.Scatter(
        x=[0, max_vol],
        y=[risk_free_rate, expected_return],
        mode='lines',
        name='è³‡æœ¬å¸‚å ´ç·š',
        line=dict(color='gray', width=1, dash='dot')
    ))

    fig.update_layout(
        title="æ•ˆç‡å‰ç·£èˆ‡æœ€å„ªçµ„åˆ",
        xaxis_title="å¹´åŒ–æ³¢å‹•ç‡ (%)",
        yaxis_title="å¹´åŒ–å ±é…¬ç‡ (%)",
        height=500,
        hovermode='closest',
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)


def render_weight_allocation(weights: Dict[str, float]):
    """æ¬Šé‡åˆ†é…åœ“é¤…åœ–"""
    labels = list(weights.keys())
    values = [w * 100 for w in weights.values()]

    fig = go.Figure(data=[go.Pie(
        labels=labels,
        values=values,
        hole=0.4,  # Donut chart
        marker=dict(
            colors=['#2563eb', '#22c55e', '#eab308', '#f97316', '#8b5cf6']
        ),
        textinfo='label+percent',
        textposition='auto',
        textfont_size=14
    )])

    fig.update_layout(
        title="æ¬Šé‡é…ç½®",
        height=400,
        showlegend=True,
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)
```

---

### Tab 4: é¢¨éšªæŒ‡æ¨™

#### ä½ˆå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‰ é¢¨éšªæŒ‡æ¨™ç›£æ§                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ VaR (95%)   â”‚ CVaR (95%)  â”‚ Max DD      â”‚ æ¢å¾©æ™‚é–“ â”‚ â”‚
â”‚ â”‚   -8.5%     â”‚   -12.3%    â”‚   -25.6%    â”‚  45 å¤©   â”‚ â”‚
â”‚ â”‚   âš ï¸        â”‚   âš ï¸        â”‚   âŒ        â”‚   âš ï¸    â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [å›æ’¤æ›²ç·šåœ–]                                             â”‚
â”‚                                                           â”‚
â”‚  - X è»¸ï¼šæ™‚é–“                                             â”‚
â”‚  - Y è»¸ï¼šå›æ’¤ç™¾åˆ†æ¯” (0% ~ -100%)                         â”‚
â”‚  - æ¨™è¨˜ï¼šæœ€å¤§å›æ’¤é»                                       â”‚
â”‚  - å¡«å……ï¼šå›æ’¤å€åŸŸï¼ˆç´…è‰²ï¼‰                                 â”‚
â”‚                                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                           â”‚
â”‚  [VaR / CVaR åˆ†å¸ƒç›´æ–¹åœ–]                                 â”‚
â”‚                                                           â”‚
â”‚  - X è»¸ï¼šæ”¶ç›Šç‡                                           â”‚
â”‚  - Y è»¸ï¼šé »ç‡                                             â”‚
â”‚  - æ¨™è¨˜ç·šï¼šVaR 95%, VaR 99%, CVaR 95%                    â”‚
â”‚  - å¡«å……ï¼šå°¾éƒ¨å€åŸŸï¼ˆç´…è‰²ï¼‰                                 â”‚
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### åœ–è¡¨è¦æ ¼

```python
def render_drawdown_curve(equity_curve: pd.Series):
    """å›æ’¤æ›²ç·šåœ–"""
    # è¨ˆç®—å›æ’¤
    running_max = equity_curve.expanding().max()
    drawdown = (equity_curve - running_max) / running_max

    fig = go.Figure()

    # å›æ’¤æ›²ç·š
    fig.add_trace(go.Scatter(
        x=drawdown.index,
        y=drawdown * 100,
        mode='lines',
        name='å›æ’¤',
        line=dict(color='#ef4444', width=2),
        fill='tozeroy',
        fillcolor='rgba(239, 68, 68, 0.2)'
    ))

    # æ¨™è¨˜æœ€å¤§å›æ’¤
    max_dd_idx = drawdown.idxmin()
    max_dd_value = drawdown.min()

    fig.add_trace(go.Scatter(
        x=[max_dd_idx],
        y=[max_dd_value * 100],
        mode='markers+text',
        name='æœ€å¤§å›æ’¤',
        marker=dict(size=12, color='#dc2626'),
        text=[f'{max_dd_value*100:.1f}%'],
        textposition='bottom center'
    ))

    fig.update_layout(
        title="æ­·å²å›æ’¤æ›²ç·š",
        xaxis_title="æ—¥æœŸ",
        yaxis_title="å›æ’¤ (%)",
        yaxis_range=[min(drawdown*100)*1.2, 5],
        height=400,
        hovermode='x unified',
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)


def render_var_distribution(returns: pd.Series, var_95: float, cvar_95: float):
    """VaR / CVaR åˆ†å¸ƒåœ–"""
    fig = go.Figure()

    # æ”¶ç›Šç‡ç›´æ–¹åœ–
    fig.add_trace(go.Histogram(
        x=returns * 100,
        nbinsx=50,
        name='æ”¶ç›Šåˆ†å¸ƒ',
        marker_color='#3b82f6',
        opacity=0.7
    ))

    # VaR 95% ç·š
    fig.add_vline(
        x=var_95 * 100,
        line_dash="dash",
        line_color="#f97316",
        line_width=2,
        annotation_text=f"VaR 95%: {var_95*100:.2f}%",
        annotation_position="top left"
    )

    # CVaR 95% ç·š
    fig.add_vline(
        x=cvar_95 * 100,
        line_dash="solid",
        line_color="#ef4444",
        line_width=2,
        annotation_text=f"CVaR 95%: {cvar_95*100:.2f}%",
        annotation_position="bottom left"
    )

    # å¡«å……å°¾éƒ¨å€åŸŸ
    fig.add_vrect(
        x0=returns.min() * 100,
        x1=var_95 * 100,
        fillcolor="#fef2f2",
        opacity=0.3,
        layer="below",
        line_width=0
    )

    fig.update_layout(
        title="æ”¶ç›Šåˆ†å¸ƒèˆ‡é¢¨éšªå€¼",
        xaxis_title="æ”¶ç›Šç‡ (%)",
        yaxis_title="é »ç‡",
        height=400,
        showlegend=False,
        **PLOTLY_LAYOUT
    )

    st.plotly_chart(fig, use_container_width=True)
```

---

## ğŸ“± RESPONSIVEï¼ˆéŸ¿æ‡‰å¼è¨­è¨ˆï¼‰

### ä¸»è¦è£ç½®
æ­¤å„€è¡¨æ¿ä¸»è¦åœ¨**æ¡Œé¢ç«¯**ä½¿ç”¨ï¼ˆå¯¬è¢å¹• â‰¥ 1280pxï¼‰ï¼Œå› ç‚ºï¼š
- éœ€è¦åŒæ™‚æŸ¥çœ‹å¤šå€‹åœ–è¡¨
- è³‡æ–™å¯†é›†ï¼Œéœ€è¦è¶³å¤ ç©ºé–“
- é‡åŒ–äº¤æ˜“è€…é€šå¸¸ä½¿ç”¨å¤šè¢å¹•è¨­å®š

### éŸ¿æ‡‰å¼ç­–ç•¥

```python
# Streamlit è‡ªé©æ‡‰ columns
# æ¡Œé¢ç«¯ï¼š4 æ¬„
# å¹³æ¿ç«¯ï¼ˆ< 1024pxï¼‰ï¼š2 æ¬„
# æ‰‹æ©Ÿç«¯ï¼ˆ< 768pxï¼‰ï¼š1 æ¬„

# ä½¿ç”¨ Streamlit çš„éŸ¿æ‡‰å¼å®¹å™¨
col1, col2, col3, col4 = st.columns([1, 1, 1, 1])
# Streamlit æœƒè‡ªå‹•åœ¨å°è¢å¹•ä¸Šå †ç–Š

# åœ–è¡¨ä½¿ç”¨ use_container_width=True
st.plotly_chart(fig, use_container_width=True)
# è‡ªå‹•é©æ‡‰å®¹å™¨å¯¬åº¦
```

### æ–·é»è¡Œç‚º

| æ–·é» | å¯¬åº¦ | ä½ˆå±€è®ŠåŒ– |
|------|------|----------|
| `xl` | â‰¥1280px | 4 æ¬„æŒ‡æ¨™ + 2 æ¬„åœ–è¡¨ |
| `lg` | 1024-1279px | 3 æ¬„æŒ‡æ¨™ + 2 æ¬„åœ–è¡¨ |
| `md` | 768-1023px | 2 æ¬„æŒ‡æ¨™ + 1 æ¬„åœ–è¡¨ |
| `sm` | <768px | 1 æ¬„ï¼ˆå‚ç›´å †ç–Šï¼‰ |

---

## ğŸ¯ UX åŸå‰‡æ‡‰ç”¨

### 1. èªçŸ¥è² è·æœ€å°åŒ–ï¼ˆMiller's Lawï¼‰
- **4 å€‹ä¸»è¦ Tab**ï¼ˆä¸è¶…é 7Â±2ï¼‰
- æ¯å€‹ Tab å…§æœ€å¤š 3-4 å€‹è¦–è¦ºå…ƒç´ 
- ä½¿ç”¨æŠ˜ç–Šå€å¡Šéš±è—é€²éšé¸é …

### 2. å³æ™‚å›é¥‹ï¼ˆPeak-End Ruleï¼‰
```python
# é¸æ“‡ç­–ç•¥å¾Œç«‹å³é¡¯ç¤ºæ‘˜è¦
if len(selected_strategies) > 0:
    with st.spinner("è¨ˆç®—ä¸­..."):
        results = calculate_metrics(selected_strategies)

    # æˆåŠŸè¨Šæ¯
    st.success(f"âœ… å·²åˆ†æ {len(selected_strategies)} å€‹ç­–ç•¥")
```

### 3. å°ˆæ¥­è¡“èªèªªæ˜ï¼ˆTesler's Lawï¼‰
```python
# ä½¿ç”¨ help åƒæ•¸æä¾›èªªæ˜
st.metric(
    label="VaR (95%)",
    value=f"{var_95*100:.2f}%",
    help="""
    Value at Risk: åœ¨ 95% ä¿¡å¿ƒæ°´æº–ä¸‹ï¼Œ
    æœªä¾†ä¸€å¤©æœ€å¤§å¯èƒ½æå¤±çš„é‡‘é¡ã€‚
    """
)
```

### 4. è¦–è¦ºåˆ†çµ„ï¼ˆGestalt Principlesï¼‰
- ä½¿ç”¨ `st.container()` å»ºç«‹è¦–è¦ºå€å¡Š
- ç›¸é—œæŒ‡æ¨™æ”¾åœ¨åŒä¸€ `st.columns()`
- é–“è·ç³»çµ±å»ºç«‹è¦–è¦ºå‘¼å¸ç©ºé–“

### 5. é˜²éŒ¯æ©Ÿåˆ¶ï¼ˆError Preventionï¼‰
```python
# åƒæ•¸é©—è­‰
if len(selected_strategies) < 2:
    st.warning("å»ºè­°é¸æ“‡è‡³å°‘ 2 å€‹ç­–ç•¥ä»¥åˆ†æç›¸é—œæ€§")

# è³‡æ–™æª¢æŸ¥
if total_trades < 30:
    st.error("äº¤æ˜“ç­†æ•¸ä¸è¶³ï¼ˆ< 30ï¼‰ï¼Œçµæœå¯èƒ½ä¸å¯é ")
```

---

## ğŸ“ å¯¦ä½œæª¢æŸ¥æ¸…å–®

### è³‡æ–™å±¤
- [x] æ•´åˆ `KellyPositionSizer` è¨ˆç®— Full/Half/Quarter Kelly
- [x] æ•´åˆ `CorrelationAnalyzer` è¨ˆç®—ç›¸é—œæ€§çŸ©é™£
- [x] æ•´åˆ `PortfolioOptimizer` è¨ˆç®—æœ€å„ªæ¬Šé‡
- [x] è¨ˆç®— VaRã€CVaRã€MaxDDã€æ¢å¾©æ™‚é–“

### UI å±¤
- [x] æ¨™é¡Œèˆ‡æ§åˆ¶å€ä½ˆå±€
- [x] 5 å€‹æ‘˜è¦æŒ‡æ¨™å¡ç‰‡
- [x] 4 å€‹ Tabs æ¶æ§‹
- [x] Tab 1: Kelly Criterion æ›²ç·šèˆ‡è¡¨æ ¼
- [x] Tab 2: ç›¸é—œæ€§ç†±åœ–èˆ‡æ»¾å‹•ç›¸é—œæ€§
- [x] Tab 3: æ•ˆç‡å‰ç·£èˆ‡æ¬Šé‡é…ç½®
- [x] Tab 4: å›æ’¤æ›²ç·šèˆ‡ VaR åˆ†å¸ƒ

### ç‹€æ…‹è™•ç†
- [x] Empty Stateï¼ˆæœªé¸æ“‡ç­–ç•¥ï¼‰
- [x] Loading Stateï¼ˆè¨ˆç®—ä¸­ï¼‰
- [x] Error Stateï¼ˆè¨ˆç®—å¤±æ•—ï¼‰
- [x] Success Stateï¼ˆé¡¯ç¤ºçµæœï¼‰

### è¦–è¦ºä¸€è‡´æ€§
- [x] è‰²å½©ä½¿ç”¨ç¬¦åˆ Design Tokens
- [x] åœ–è¡¨é…è‰²ä¸€è‡´
- [x] åœ“è§’ã€é–“è·ç¬¦åˆè¦ç¯„
- [x] å­—é«”å¤§å°ç¬¦åˆå±¤ç´š

### ç„¡éšœç¤™
- [x] åœ–è¡¨æœ‰æ›¿ä»£æ–‡å­—èªªæ˜
- [x] è‰²å½©å°æ¯”åº¦ç¬¦åˆ WCAG AA
- [x] éµç›¤å¯æ“ä½œï¼ˆStreamlit é è¨­æ”¯æ´ï¼‰

---

## ğŸ”— ç›¸é—œæª”æ¡ˆ

### è³‡æ–™ä¾†æº
- `src/risk/position_sizing.py` - Kelly Criterion è¨ˆç®—
- `src/risk/correlation.py` - ç›¸é—œæ€§åˆ†æ
- `src/optimizer/portfolio.py` - çµ„åˆå„ªåŒ–
- `src/validator/stress_test.py` - VaR/CVaR è¨ˆç®—

### è¨­è¨ˆåƒè€ƒ
- `~/.claude/skills/ui/references/tokens.md` - Design Tokens
- `~/.claude/skills/ui/references/components.md` - å…ƒä»¶è¦æ ¼
- `~/.claude/skills/ux/references/psychology.md` - UX åŸå‰‡
- `~/.claude/skills/ux/references/patterns.md` - UX æ¨¡å¼

### ç¾æœ‰é é¢
- `ui/pages/1_ğŸ“Š_Dashboard.py` - åƒè€ƒä½ˆå±€èˆ‡é¢¨æ ¼

---

## ğŸ“ è¨­è¨ˆæ±ºç­–ç†ç”±

### ç‚ºä»€éº¼ä½¿ç”¨ Tabsï¼Ÿ
- **ç†ç”±**ï¼š4 å€‹åˆ†æç¶­åº¦ï¼ˆKelly / ç›¸é—œæ€§ / å„ªåŒ– / é¢¨éšªï¼‰å…§å®¹ç¨ç«‹ä½†ç›¸é—œ
- **UX åŸå‰‡**ï¼šæ¸›å°‘æ»¾å‹•è·é›¢ï¼ˆFitts's Lawï¼‰ï¼Œæå‡æ“ä½œæ•ˆç‡
- **å‚™é¸æ–¹æ¡ˆ**ï¼šå‚ç›´å †ç–Šï¼ˆæœƒå°è‡´é é¢éé•·ï¼Œéœ€è¦å¤§é‡æ»¾å‹•ï¼‰

### ç‚ºä»€éº¼ Half Kelly æ˜¯é è¨­ï¼Ÿ
- **ç†ç”±**ï¼šå¹³è¡¡æˆé•·èˆ‡æ³¢å‹•ï¼Œé©åˆå¤§å¤šæ•¸äº¤æ˜“è€…
- **UX åŸå‰‡**ï¼šæä¾›æ¨è–¦é è¨­å€¼ï¼ˆHick's Lawï¼‰ï¼Œæ¸›å°‘æ±ºç­–è² æ“”
- **åƒè€ƒ**ï¼šé‡åŒ–äº¤æ˜“æ–‡ç»æ™®éå»ºè­° Half Kelly

### ç‚ºä»€éº¼ä½¿ç”¨ç†±åœ–è€Œéæ•¸å­—è¡¨æ ¼ï¼Ÿ
- **ç†ç”±**ï¼šäººé¡å°è¦–è¦ºæ¨¡å¼çš„è¾¨è­˜é€Ÿåº¦ > æ•¸å­—æ¯”è¼ƒ
- **UX åŸå‰‡**ï¼šé™ä½èªçŸ¥è² è·ï¼ˆCognitive Load Theoryï¼‰
- **å‚™é¸æ–¹æ¡ˆ**ï¼šåŒæ™‚æä¾›ï¼ˆç†±åœ–ç‚ºä¸»ï¼Œè©³ç´°æ•¸å€¼ç”¨ tooltipï¼‰

### ç‚ºä»€éº¼æ¨™è¨˜å·¦å°¾ç›¸é—œæ€§ç‚ºè­¦å‘Šï¼Ÿ
- **ç†ç”±**ï¼šä¸‹è·Œæ™‚é«˜ç›¸é—œæ€§è¡¨ç¤ºåˆ†æ•£æ•ˆæœå·®ï¼Œé¢¨éšªç®¡ç†å¤±æ•ˆ
- **UX åŸå‰‡**ï¼šVon Restorff Effectï¼ˆçªå‡ºé‡è¦é¢¨éšªï¼‰
- **è²¡å‹™æ„ç¾©**ï¼šé€™æ˜¯çµ„åˆé…ç½®çš„æ ¸å¿ƒé¢¨éšªæŒ‡æ¨™

---

## âœ… å®Œæˆæ¨™æº–

### åŠŸèƒ½å®Œæ•´æ€§
- [x] æ‰€æœ‰ 4 å€‹ Tab çš„æ ¸å¿ƒåŠŸèƒ½å¯¦ä½œ
- [x] è³‡æ–™è¨ˆç®—æ­£ç¢ºï¼ˆKelly / ç›¸é—œæ€§ / å„ªåŒ– / VaRï¼‰
- [x] äº’å‹•å…ƒç´ æ­£å¸¸é‹ä½œï¼ˆé¸æ“‡å™¨ã€æŒ‰éˆ•ã€Tabï¼‰

### è¦–è¦ºä¸€è‡´æ€§
- [x] è‰²å½©ç¬¦åˆ Design Tokensï¼ˆä¸ hardcodeï¼‰
- [x] é–“è·ã€åœ“è§’ç¬¦åˆè¦ç¯„
- [x] åœ–è¡¨é¢¨æ ¼çµ±ä¸€ï¼ˆPlotly é…è‰²ï¼‰

### UX å“è³ª
- [x] Empty State æœ‰å¼•å°
- [x] Loading State æœ‰å›é¥‹
- [x] Error State æœ‰å»ºè­°
- [x] å°ˆæ¥­è¡“èªæœ‰èªªæ˜

### æ•ˆèƒ½
- [x] è¨ˆç®—æ™‚é–“ < 5 ç§’ï¼ˆ30 å€‹ç­–ç•¥ï¼‰
- [x] åœ–è¡¨æ¸²æŸ“æµæš¢ï¼ˆç„¡å¡é “ï¼‰
- [x] ä½¿ç”¨ `@st.cache_data` å¿«å–è¨ˆç®—çµæœ

---

**è¦æ ¼ç‰ˆæœ¬**: 1.0
**æœ€å¾Œæ›´æ–°**: 2026-01-11
**å¯©æ ¸ç‹€æ…‹**: å¾… DEVELOPER å¯¦ä½œ
