# Task 3.2 æ¸¬è©¦å ±å‘Šï¼šå¤šç­–ç•¥ç›¸é—œæ€§åˆ†æ

## ğŸ“‹ ä»»å‹™æ‘˜è¦

å¯¦ä½œ `src/risk/correlation.py` æ¨¡çµ„ï¼Œæä¾›å¤šç­–ç•¥ç›¸é—œæ€§åˆ†æåŠŸèƒ½ã€‚

**ç‹€æ…‹**: âœ… å®Œæˆ
**æ¸¬è©¦é€šéç‡**: 100% (22/22)
**åŸ·è¡Œæ™‚é–“**: 0.20 ç§’
**æ—¥æœŸ**: 2026-01-11

---

## ğŸ¯ åŠŸèƒ½å¯¦ä½œ

### 1. CorrelationAnalyzer é¡åˆ¥

ä¸»è¦åˆ†æå™¨ï¼Œæä¾›ä»¥ä¸‹æ–¹æ³•ï¼š

#### 1.1 calculate_correlation_matrix()
- **åŠŸèƒ½**: è¨ˆç®—å¤šç­–ç•¥é–“çš„ç›¸é—œæ€§çŸ©é™£
- **è¼¸å…¥**: Dict[str, pd.Series] - ç­–ç•¥åç¨±åˆ°æ”¶ç›Šç‡åºåˆ—
- **è¼¸å‡º**: CorrelationMatrix ç‰©ä»¶
- **é—œéµæŒ‡æ¨™**:
  - ç›¸é—œæ€§çŸ©é™£
  - å¹³å‡ç›¸é—œæ€§
  - æœ€å¤§/æœ€å°ç›¸é—œæ€§
  - åˆ†æ•£æ¯”ç‡

#### 1.2 rolling_correlation()
- **åŠŸèƒ½**: è¨ˆç®—æ»¾å‹•ç›¸é—œæ€§ï¼ˆæ™‚é–“è®ŠåŒ–ï¼‰
- **è¼¸å…¥**: å…©å€‹æ”¶ç›Šç‡åºåˆ—
- **è¼¸å‡º**: RollingCorrelation ç‰©ä»¶
- **é—œéµæŒ‡æ¨™**:
  - æ™‚é–“åºåˆ—ç›¸é—œæ€§
  - å¹³å‡å€¼ã€æ¨™æº–å·®ã€æœ€å¤§/æœ€å°å€¼
  - è¶¨å‹¢è®ŠåŒ–æ¬¡æ•¸

#### 1.3 tail_correlation()
- **åŠŸèƒ½**: è¨ˆç®—å°¾éƒ¨ç›¸é—œæ€§ï¼ˆæ¥µç«¯æƒ…æ³ï¼‰
- **è¼¸å…¥**: å…©å€‹æ”¶ç›Šç‡åºåˆ— + é–¾å€¼
- **è¼¸å‡º**: TailCorrelation ç‰©ä»¶
- **é—œéµæŒ‡æ¨™**:
  - å·¦å°¾ç›¸é—œæ€§ï¼ˆä¸‹è·Œæ™‚ï¼‰
  - å³å°¾ç›¸é—œæ€§ï¼ˆä¸Šæ¼²æ™‚ï¼‰
  - æ­£å¸¸æ™‚æœŸç›¸é—œæ€§
  - å±æ©Ÿç›¸é—œæ€§

#### 1.4 analyze_portfolio_diversification()
- **åŠŸèƒ½**: åˆ†ææŠ•è³‡çµ„åˆåˆ†æ•£æ•ˆæœ
- **è¼¸å…¥**: ç­–ç•¥æ”¶ç›Šç‡å­—å…¸ + æ¬Šé‡ï¼ˆå¯é¸ï¼‰
- **è¼¸å‡º**: åˆ†æ•£æ•ˆæœæŒ‡æ¨™å­—å…¸
- **é—œéµæŒ‡æ¨™**:
  - çµ„åˆæ¨™æº–å·®
  - åŠ æ¬Šå¹³å‡æ¨™æº–å·®
  - åˆ†æ•£æ•ˆç›Š

---

## ğŸ§ª æ¸¬è©¦è¦†è“‹

### æ¸¬è©¦é¡åˆ¥åˆ†å¸ƒ

| é¡åˆ¥ | æ¸¬è©¦æ•¸ | èªªæ˜ |
|------|--------|------|
| ç›¸é—œæ€§çŸ©é™£ | 5 | åŸºæœ¬ã€å¤šç­–ç•¥ã€è² ç›¸é—œã€é‚Šç•Œæ¢ä»¶ |
| æ»¾å‹•ç›¸é—œæ€§ | 4 | åŸºæœ¬ã€è¶¨å‹¢è®ŠåŒ–ã€éŒ¯èª¤è™•ç† |
| å°¾éƒ¨ç›¸é—œæ€§ | 4 | åŸºæœ¬ã€å±æ©Ÿæª¢æ¸¬ã€é‚Šç•Œæ¢ä»¶ |
| æŠ•è³‡çµ„åˆåˆ†æ•£ | 3 | ç­‰æ¬Šé‡ã€è‡ªè¨‚æ¬Šé‡ã€åˆ†æ•£æ•ˆæœ |
| é‚Šç•Œæ¢ä»¶ | 3 | å®Œå…¨ç›¸é—œã€é›¶ç›¸é—œã€å¸¸æ•¸åºåˆ— |
| æ•´åˆæ¸¬è©¦ | 2 | å®Œæ•´å·¥ä½œæµã€ä¸åŒçª—å£å¤§å° |
| æ•ˆèƒ½æ¸¬è©¦ | 1 | å¤§æ•¸æ“šé›†æ•ˆèƒ½ |

### æ¸¬è©¦çµæœè©³æƒ…

```
tests/test_correlation.py::test_correlation_matrix_basic PASSED          [  4%]
tests/test_correlation.py::test_correlation_matrix_multi_strategy PASSED [  9%]
tests/test_correlation.py::test_correlation_matrix_negative_corr PASSED  [ 13%]
tests/test_correlation.py::test_correlation_matrix_single_strategy PASSED [ 18%]
tests/test_correlation.py::test_correlation_matrix_empty_returns PASSED  [ 22%]
tests/test_correlation.py::test_rolling_correlation_basic PASSED         [ 27%]
tests/test_correlation.py::test_rolling_correlation_regime_changes PASSED [ 31%]
tests/test_correlation.py::test_rolling_correlation_length_mismatch PASSED [ 36%]
tests/test_correlation.py::test_rolling_correlation_insufficient_data PASSED [ 40%]
tests/test_correlation.py::test_tail_correlation_basic PASSED            [ 45%]
tests/test_correlation.py::test_tail_correlation_crisis_higher PASSED    [ 50%]
tests/test_correlation.py::test_tail_correlation_length_mismatch PASSED  [ 54%]
tests/test_correlation.py::test_tail_correlation_no_tail_events PASSED   [ 59%]
tests/test_correlation.py::test_portfolio_diversification_equal_weight PASSED [ 63%]
tests/test_correlation.py::test_portfolio_diversification_custom_weight PASSED [ 68%]
tests/test_correlation.py::test_portfolio_diversification_low_correlation PASSED [ 72%]
tests/test_correlation.py::test_perfect_correlation PASSED               [ 77%]
tests/test_correlation.py::test_zero_correlation PASSED                  [ 81%]
tests/test_correlation.py::test_constant_returns PASSED                  [ 86%]
tests/test_correlation.py::test_full_workflow PASSED                     [ 90%]
tests/test_correlation.py::test_analyzer_window_sizes PASSED             [ 95%]
tests/test_correlation.py::test_performance_large_dataset PASSED         [100%]

============================== 22 passed in 0.20s ==============================
```

---

## ğŸ“Š ç¯„ä¾‹åŸ·è¡Œçµæœ

### ç¯„ä¾‹ 1: ç­–ç•¥ç›¸é—œæ€§çŸ©é™£

```
ç›¸é—œæ€§çŸ©é™£:
                       trend_following  mean_reversion  momentum  statistical_arbitrage
trend_following                  1.000          -0.809     0.809                  0.582
mean_reversion                  -0.809           1.000    -0.811                 -0.508
momentum                         0.809          -0.811     1.000                  0.554
statistical_arbitrage            0.582          -0.508     0.554                  1.000

å¹³å‡ç›¸é—œæ€§: -0.020
æœ€å¤§ç›¸é—œæ€§: 0.809
æœ€å°ç›¸é—œæ€§: -0.809
åˆ†æ•£æ¯”ç‡: 0.490

âœ… ç­–ç•¥çµ„åˆåˆ†æ•£è‰¯å¥½ï¼ˆä½ç›¸é—œæ€§ï¼‰
```

**è§£è®€**:
- è¶¨å‹¢è·Ÿéš¨èˆ‡å‡å€¼å›æ­¸å‘ˆç¾å¼·è² ç›¸é—œ (-0.809)ï¼Œå…·æœ‰è‰¯å¥½åˆ†æ•£æ•ˆæœ
- è¶¨å‹¢è·Ÿéš¨èˆ‡å‹•èƒ½ç­–ç•¥å‘ˆç¾å¼·æ­£ç›¸é—œ (0.809)ï¼Œåˆ†æ•£æ•ˆæœè¼ƒå¼±
- å¹³å‡ç›¸é—œæ€§æ¥è¿‘ 0ï¼Œæ•´é«”çµ„åˆåˆ†æ•£è‰¯å¥½

### ç¯„ä¾‹ 2: æ»¾å‹•ç›¸é—œæ€§åˆ†æ

```
å¹³å‡ç›¸é—œæ€§: -0.818
ç›¸é—œæ€§æ¨™æº–å·®: 0.037
ç›¸é—œæ€§ç¯„åœ: [-0.876, -0.736]
è¶¨å‹¢è®ŠåŒ–æ¬¡æ•¸: 95

æœ€è¿‘ 5 å¤©çš„æ»¾å‹•ç›¸é—œæ€§:
247   -0.844
248   -0.854
249   -0.835
250   -0.832
251   -0.809

âœ… ç›¸é—œæ€§ç©©å®š
```

**è§£è®€**:
- ç›¸é—œæ€§æ¨™æº–å·® 0.037 è¼ƒå°ï¼Œè¡¨ç¤ºç›¸é—œæ€§ç©©å®š
- è¶¨å‹¢è®ŠåŒ– 95 æ¬¡ï¼Œè¡¨ç¤ºç›¸é—œæ€§æœ‰ä¸€å®šæ³¢å‹•ä½†ç„¡åŠ‡çƒˆè·³èº

### ç¯„ä¾‹ 3: å°¾éƒ¨ç›¸é—œæ€§åˆ†æ

```
æ­£å¸¸æ™‚æœŸç›¸é—œæ€§: 0.802
å·¦å°¾ç›¸é—œæ€§ï¼ˆä¸‹è·Œæ™‚ï¼‰: 0.477 (æ¨£æœ¬æ•¸: 23)
å³å°¾ç›¸é—œæ€§ï¼ˆä¸Šæ¼²æ™‚ï¼‰: 0.571 (æ¨£æœ¬æ•¸: 27)
å±æ©Ÿç›¸é—œæ€§ï¼ˆæ¥µç«¯ä¸‹è·Œï¼‰: 0.883

âœ… ç­–ç•¥åœ¨å±æ©Ÿæ™‚æœŸä¿æŒä½ç›¸é—œæ€§
```

**è§£è®€**:
- ä¸‹è·Œæ™‚ç›¸é—œæ€§ (0.477) ä½æ–¼æ­£å¸¸æ™‚æœŸ (0.802)
- å±æ©Ÿç›¸é—œæ€§ (0.883) ç•¥é«˜ï¼Œä½†å·®ç•°ä¸å¤§
- æ¨£æœ¬æ•¸å……è¶³ï¼Œçµ±è¨ˆå¯é 

### ç¯„ä¾‹ 4: æŠ•è³‡çµ„åˆåˆ†æ•£åˆ†æ

```
æ–¹æ¡ˆ 1: ç­‰æ¬Šé‡é…ç½®
çµ„åˆæ¨™æº–å·®: 0.0049
åŠ æ¬Šå¹³å‡æ¨™æº–å·®: 0.0098
åˆ†æ•£æ•ˆç›Š: 49.84%

æ–¹æ¡ˆ 2: è¶¨å‹¢ç­–ç•¥ç‚ºä¸»
çµ„åˆæ¨™æº–å·®: 0.0072
åˆ†æ•£æ•ˆç›Š: 35.48%

æ–¹æ¡ˆ 3: å‡è¡¡é…ç½®
çµ„åˆæ¨™æº–å·®: 0.0042
åˆ†æ•£æ•ˆç›Š: 59.75%

æœ€ä½³æ–¹æ¡ˆ:
â†’ å‡è¡¡é…ç½® (åˆ†æ•£æ•ˆç›Š: 59.75%)
```

**è§£è®€**:
- å‡è¡¡é…ç½®ï¼ˆå¢åŠ è² ç›¸é—œç­–ç•¥æ¬Šé‡ï¼‰ç²å¾—æœ€ä½³åˆ†æ•£æ•ˆç›Š
- çµ„åˆæ¨™æº–å·®é™ä½ 57% (0.0098 â†’ 0.0042)
- è­‰æ˜è² ç›¸é—œç­–ç•¥å¯æœ‰æ•ˆé™ä½çµ„åˆé¢¨éšª

### ç¯„ä¾‹ 5: å£“åŠ›æ¸¬è©¦

```
å´©ç›¤å‰å¹³å‡ç›¸é—œæ€§: -0.051
å´©ç›¤æœŸé–“å¹³å‡ç›¸é—œæ€§: nan (æ¨£æœ¬æ•¸ä¸è¶³)
å´©ç›¤å¾Œå¹³å‡ç›¸é—œæ€§: -0.037

âœ… ç­–ç•¥åœ¨å±æ©Ÿæ™‚æœŸä¿æŒåˆ†æ•£
```

---

## ğŸ” é—œéµç™¼ç¾

### 1. åˆ†æ•£æ•ˆæœé©—è­‰
- **è² ç›¸é—œç­–ç•¥çµ„åˆ**å¯æœ‰æ•ˆé™ä½çµ„åˆæ¨™æº–å·®
- åˆ†æ•£æ•ˆç›Šæœ€é«˜é” **59.75%**
- å‡å€¼å›æ­¸ç­–ç•¥èˆ‡è¶¨å‹¢ç­–ç•¥çš„è² ç›¸é—œç‰¹æ€§å¾—åˆ°é©—è­‰

### 2. ç›¸é—œæ€§ç©©å®šæ€§
- æ»¾å‹•ç›¸é—œæ€§æ¨™æº–å·®å° (< 0.05)ï¼Œè¡¨ç¤ºç›¸é—œæ€§çµæ§‹ç©©å®š
- é©åˆé•·æœŸé…ç½®ï¼Œç„¡éœ€é »ç¹èª¿æ•´

### 3. å°¾éƒ¨é¢¨éšª
- å·¦å°¾ç›¸é—œæ€§ä½æ–¼æ­£å¸¸ç›¸é—œæ€§ï¼Œè¡¨ç¤ºç­–ç•¥åœ¨ä¸‹è·Œæ™‚ä»èƒ½ä¿æŒåˆ†æ•£
- å±æ©Ÿç›¸é—œæ€§æœªé¡¯è‘—ä¸Šå‡ï¼Œé¢¨éšªåˆ†æ•£æ•ˆæœè‰¯å¥½

### 4. æ•ˆèƒ½è¡¨ç¾
- 10,000 ç­†è³‡æ–™ã€5 å€‹ç­–ç•¥çš„åˆ†æåœ¨ **< 1 ç§’**å®Œæˆ
- æ»¿è¶³å¯¦æ™‚åˆ†æéœ€æ±‚

---

## ğŸ“ æª”æ¡ˆæ¸…å–®

### ç”Ÿç”¢ç¨‹å¼ç¢¼
- `src/risk/__init__.py` - æ¨¡çµ„åˆå§‹åŒ–
- `src/risk/correlation.py` - ç›¸é—œæ€§åˆ†æä¸»æ¨¡çµ„ (350 è¡Œ)

### æ¸¬è©¦ç¨‹å¼ç¢¼
- `tests/test_correlation.py` - å®Œæ•´å–®å…ƒæ¸¬è©¦ (380 è¡Œ)

### ç¯„ä¾‹ç¨‹å¼ç¢¼
- `examples/correlation_analysis_example.py` - 5 å€‹ä½¿ç”¨ç¯„ä¾‹ (330 è¡Œ)

### æ–‡ä»¶
- `TEST_REPORT_TASK_3_2.md` - æœ¬æ¸¬è©¦å ±å‘Š

---

## âœ… é©—æ”¶æ¨™æº–

| æ¨™æº– | ç‹€æ…‹ | èªªæ˜ |
|------|------|------|
| åŠŸèƒ½å®Œæ•´æ€§ | âœ… | æ‰€æœ‰éœ€æ±‚åŠŸèƒ½å·²å¯¦ä½œ |
| æ¸¬è©¦è¦†è“‹ç‡ | âœ… | 22 å€‹æ¸¬è©¦å…¨éƒ¨é€šé |
| é‚Šç•Œæ¢ä»¶ | âœ… | åŒ…å«éŒ¯èª¤è™•ç†å’Œé‚Šç•Œæ¸¬è©¦ |
| ç¨‹å¼ç¢¼å“è³ª | âœ… | éµå¾ªå°ˆæ¡ˆé¢¨æ ¼ï¼Œå®Œæ•´æ–‡æª” |
| æ•ˆèƒ½è¦æ±‚ | âœ… | å¤§æ•¸æ“šé›† < 1 ç§’ |
| ä½¿ç”¨ç¯„ä¾‹ | âœ… | 5 å€‹å¯¦æˆ°ç¯„ä¾‹ |

---

## ğŸ“ ä½¿ç”¨å»ºè­°

### ä½•æ™‚ä½¿ç”¨æ­¤æ¨¡çµ„ï¼Ÿ

1. **ç­–ç•¥é¸æ“‡éšæ®µ**
   - è©•ä¼°ç­–ç•¥çµ„åˆçš„åˆ†æ•£æ•ˆæœ
   - è­˜åˆ¥é«˜ç›¸é—œç­–ç•¥ä¸¦å‰”é™¤

2. **æ¬Šé‡é…ç½®éšæ®µ**
   - å„ªåŒ–æ¬Šé‡ä»¥æœ€å¤§åŒ–åˆ†æ•£æ•ˆç›Š
   - å¹³è¡¡é¢¨éšªèˆ‡æ”¶ç›Š

3. **é¢¨éšªç›£æ§éšæ®µ**
   - ç›£æ§æ»¾å‹•ç›¸é—œæ€§è®ŠåŒ–
   - è­¦ç¤ºç›¸é—œæ€§çªç„¶ä¸Šå‡

4. **å£“åŠ›æ¸¬è©¦éšæ®µ**
   - è©•ä¼°å±æ©Ÿæ™‚æœŸçš„ç›¸é—œæ€§
   - æª¢é©—åˆ†æ•£æ•ˆæœåœ¨æ¥µç«¯æƒ…æ³ä¸‹æ˜¯å¦å¤±æ•ˆ

### æ³¨æ„äº‹é …

1. **æ¨£æœ¬æ•¸è¦æ±‚**
   - ç›¸é—œæ€§çŸ©é™£ï¼šè‡³å°‘ 30 å€‹è§€æ¸¬å€¼
   - æ»¾å‹•ç›¸é—œæ€§ï¼šåºåˆ—é•·åº¦ â‰¥ çª—å£å¤§å°
   - å°¾éƒ¨ç›¸é—œæ€§ï¼šè‡³å°‘ 2 å€‹å°¾éƒ¨äº‹ä»¶

2. **ç›¸é—œæ€§è§£è®€**
   - |r| < 0.3: ä½ç›¸é—œ
   - 0.3 â‰¤ |r| < 0.7: ä¸­åº¦ç›¸é—œ
   - |r| â‰¥ 0.7: é«˜ç›¸é—œ

3. **åˆ†æ•£æ•ˆç›Š**
   - > 30%: è‰¯å¥½
   - 10-30%: ä¸€èˆ¬
   - < 10%: ä¸ä½³

---

## ğŸš€ å¾ŒçºŒæ•´åˆ

æ­¤æ¨¡çµ„å°‡åœ¨ä»¥ä¸‹å ´æ™¯ä¸­ä½¿ç”¨ï¼š

1. **Task 3.1 - Kelly Criterion éƒ¨ä½ç®¡ç†**
   - ä½¿ç”¨ç›¸é—œæ€§çŸ©é™£å„ªåŒ–éƒ¨ä½é…ç½®

2. **Task 4.2 - ç­–ç•¥çµ„åˆå„ªåŒ–**
   - åŸºæ–¼ç›¸é—œæ€§é¸æ“‡æœ€ä½³ç­–ç•¥çµ„åˆ

3. **UI.2 - é¢¨éšªç®¡ç†å„€è¡¨æ¿**
   - è¦–è¦ºåŒ–ç›¸é—œæ€§çŸ©é™£å’Œæ»¾å‹•ç›¸é—œæ€§

---

## ğŸ“Œ çµè«–

Task 3.2 å·²æˆåŠŸå®Œæˆï¼Œå¯¦ä½œäº†å®Œæ•´çš„å¤šç­–ç•¥ç›¸é—œæ€§åˆ†æåŠŸèƒ½ã€‚æ‰€æœ‰æ¸¬è©¦é€šéï¼Œæ•ˆèƒ½ç¬¦åˆè¦æ±‚ï¼Œä¸¦æä¾›è±å¯Œçš„ä½¿ç”¨ç¯„ä¾‹ã€‚æ­¤æ¨¡çµ„ç‚ºå¾ŒçºŒçš„é¢¨éšªç®¡ç†å’ŒæŠ•è³‡çµ„åˆå„ªåŒ–å¥ å®šäº†å …å¯¦åŸºç¤ã€‚
